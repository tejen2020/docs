{"version":3,"sources":["../node_modules/eth-block-tracker/src/base.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/superPropBase.js","../node_modules/json-rpc-random-id/index.js","../node_modules/safe-event-emitter/index.js","../../src/idRemapMiddleware.ts","../../src/createAsyncMiddleware.ts","../../src/createScaffoldMiddleware.ts","../../src/index.ts","../../src/errors.ts","../../src/mergeMiddleware.ts","../node_modules/json-rpc-engine/src/createScaffoldMiddleware.js","../node_modules/eth-json-rpc-filters/log-filter.js","../node_modules/eth-json-rpc-filters/node_modules/pify/index.js","../node_modules/eth-json-rpc-filters/base-filter-history.js","../node_modules/eth-json-rpc-filters/block-filter.js","../node_modules/eth-json-rpc-filters/tx-filter.js","../node_modules/async-mutex/es6/Semaphore.js","../node_modules/async-mutex/es6/Mutex.js","../node_modules/async-mutex/es6/withTimeout.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/toConsumableArray.js","../node_modules/eth-json-rpc-filters/hexUtils.js","../node_modules/xtend/immutable.js","../index.ts","../../src/classes.ts","../../src/error-constants.ts","../node_modules/eth-json-rpc-filters/base-filter.js","../node_modules/eth-json-rpc-filters/getBlocksForRange.js","../node_modules/eth-block-tracker/src/polling.js","../node_modules/pify/index.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/get.js","../node_modules/eth-query/index.js","../node_modules/eth-json-rpc-filters/index.js","../../src/getUniqueId.ts","../../src/JsonRpcEngine.ts","../node_modules/fast-safe-stringify/index.js","../../src/utils.ts","../node_modules/eth-json-rpc-middleware/scaffold.js","../node_modules/eth-json-rpc-filters/subscriptionManager.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/iterableToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/nonIterableSpread.js"],"names":["require","SafeEventEmitter","calculateSum","accumulator","currentValue","blockTrackerEvents","BaseBlockTracker","opts","_blockResetDuration","blockResetDuration","_blockResetTimeout","_currentBlock","_isRunning","_onNewListener","bind","_onRemoveListener","_resetCurrentBlock","_setupInternalEvents","this","Promise","resolve","once","latestBlock","eventName","removeListener","on","handler","includes","_maybeStart","_getBlockTrackerEventCount","_maybeEnd","_cancelBlockResetTimeout","_start","_setupBlockResetTimeout","_end","map","listenerCount","reduce","newBlock","currentBlock","hexToInt","_setCurrentBlock","oldBlock","emit","setTimeout","unref","clearTimeout","hexInt","Number","parseInt","module","exports","getPrototypeOf","object","property","Object","prototype","hasOwnProperty","call","max","MAX_SAFE_INTEGER","idCounter","start","Math","floor","random","util","EventEmitter","R","Reflect","ReflectApply","apply","target","receiver","args","Function","safeApply","context","err","arrayClone","arr","n","copy","Array","i","inherits","type","arguments","length","push","doError","events","_events","undefined","error","er","Error","message","len","listeners","mergeMiddleware","handlers","req","res","next","end","method","result","EthQuery","pify","BaseFilterWithHistory","bnToHex","incrementHexInt","minBlockRef","blockRefIsNumber","LogFilter","provider","params","ethQuery","assign","fromBlock","toBlock","address","topics","isArray","toLowerCase","_fetchLogs","newLogs","addInitialResults","matchingLogs","filter","log","matchLog","addResults","cb","getLogs","blockNumber","normalizedLogAddress","every","topicPattern","index","logTopic","subtopicsToMatch","topic","processFn","fn","options","proxy","unwrapped","arguments_","P","promiseModule","reject","multiArgs","errorFirst","shift","self","filterCache","WeakMap","input","exclude","objectType","TypeError","cache","Proxy","thisArg","cached","get","pified","excludeMain","set","key","match","pattern","test","desc","getOwnPropertyDescriptor","writableOrConfigurableOwn","writable","configurable","shouldFilter","include","some","allResults","newResults","concat","BaseFilter","getBlocksForRange","BlockFilter","blockBodies","blockHashes","block","hash","TxFilter","blocks","blockTxHashes","transactions","Semaphore","_maxConcurrency","_queue","_value","acquire","_this","locked","isLocked","ticket","r","_dispatch","runExclusive","callback","__awaiter","_a","value","release","__generator","_b","label","sent","trys","_currentReleaser","releaser","nextConsumer","released","Mutex","_semaphore","withTimeout","sync","timeout","timeoutError","isTimeout","asyncGeneratorStep","gen","_next","_throw","arg","info","done","then","arrayWithoutHoles","iterableToArray","unsupportedIterableToArray","nonIterableSpread","sortBlockRefs","refs","sort","refA","refB","hexString","intToHex","int","toString","unsafeRandomNibble","sortedRefs","maxBlockRef","bn","blockRef","unsafeRandomBytes","byteCount","source","updates","forEach","default","fromBlockNumber","toBlockNumber","missingBlockNumbers","fill","_","all","blockNum","query","sendAsync","id","jsonrpc","PollingBlockTracker","pollingInterval","retryTimeout","keepEventLoopActive","setSkipCacheFlag","_provider","_pollingInterval","_retryTimeout","_keepEventLoopActive","_setSkipCacheFlag","_updateLatestBlock","getLatestBlock","_performSync","catch","newErr","stack","emitErr","console","_fetchLatestBlock","_newPotentialLatest","skipCache","duration","timoutRef","results","unshift","obj","ret","create","x","superPropBase","_get","base","extend","createRandomId","currentProvider","generateFnFor","methodName","slice","pop","generateFnWithDefaultBlockFor","argCount","getBalance","getCode","getTransactionCount","getStorageAt","protocolVersion","syncing","coinbase","mining","hashrate","gasPrice","accounts","getBlockTransactionCountByHash","getBlockTransactionCountByNumber","getUncleCountByBlockHash","getUncleCountByBlockNumber","sign","sendTransaction","sendRawTransaction","estimateGas","getBlockByHash","getBlockByNumber","getTransactionByHash","getTransactionByBlockHashAndIndex","getTransactionByBlockNumberAndIndex","getTransactionReceipt","getUncleByBlockHashAndIndex","getUncleByBlockNumberAndIndex","getCompilers","compileLLL","compileSolidity","compileSerpent","newFilter","newBlockFilter","newPendingTransactionFilter","uninstallFilter","getFilterChanges","getFilterLogs","getWork","submitWork","submitHashrate","data","response","createAsyncMiddleware","createJsonRpcMiddleware","toFilterCreationMiddleware","createFilterFn","toAsyncRpcMiddleware","asyncFn","objValues","values","blockTracker","filterIndex","filters","mutex","waitForFree","middleware","releaseLock","mutexMiddlewareWrapper","eth_newFilter","newLogFilter","eth_newBlockFilter","eth_newPendingTransactionFilter","eth_uninstallFilter","uninstallFilterHandler","eth_getFilterChanges","eth_getFilterLogs","filterUpdater","update","destroy","uninstallAllFilters","installFilter","filterIndexHex","getChangesAndClear","getAllResults","Boolean","prevFilterCount","initialize","idHex","newFilterCount","updateBlockTrackerSubs","stringify","stable","deterministicStringify","stableStringify","replacerStack","replacer","spacer","decirc","val","k","parent","propertyDescriptor","defineProperty","keys","JSON","replaceGetterValues","part","compareFunction","a","b","tmp","deterministicDecirc","toJSON","v","splice","FALLBACK_ERROR","serialized","createScaffoldMiddleware","createFilterMiddleware","normalizeBlock","parentHash","sha3Uncles","miner","stateRoot","transactionsRoot","receiptsRoot","logsBloom","difficulty","number","gasLimit","gasUsed","nonce","mixHash","timestamp","extraData","subscriptions","filterManager","isDestroyed","eth_subscribe","eth_unsubscribe","removeAllListeners","createSubNewHeads","createSubFromFilter","subId","_emitSubscriptionResult","subscriptionType","sub","rawBlocks","filterParams","subscription","filterIdHex","arrayLikeToArray","iter","Symbol","iterator","from"],"mappings":"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","file":"static/js/0.42b42a4d.chunk.js","sourcesContent":["const EthQuery = require('eth-query')\nconst pify = require('pify')\nconst SafeEventEmitter = require('safe-event-emitter')\n\nconst sec = 1000\n\nconst calculateSum = (accumulator, currentValue) => accumulator + currentValue\nconst blockTrackerEvents = ['sync', 'latest']\n\nclass BaseBlockTracker extends SafeEventEmitter {\n\n  //\n  // public\n  //\n\n  constructor (opts = {}) {\n    super()\n    // config\n    this._blockResetDuration = opts.blockResetDuration || 20 * sec\n    // state\n    this._blockResetTimeout\n    this._currentBlock = null\n    this._isRunning = false\n    // bind functions for internal use\n    this._onNewListener = this._onNewListener.bind(this)\n    this._onRemoveListener = this._onRemoveListener.bind(this)\n    this._resetCurrentBlock = this._resetCurrentBlock.bind(this)\n    // listen for handler changes\n    this._setupInternalEvents()\n  }\n\n  isRunning () {\n    return this._isRunning\n  }\n\n  getCurrentBlock () {\n    return this._currentBlock\n  }\n\n  async getLatestBlock () {\n    // return if available\n    if (this._currentBlock) return this._currentBlock\n    // wait for a new latest block\n    const latestBlock = await new Promise(resolve => this.once('latest', resolve))\n    // return newly set current block\n    return latestBlock\n  }\n\n  // dont allow module consumer to remove our internal event listeners\n  removeAllListeners (eventName) {\n    // perform default behavior, preserve fn arity\n    if (eventName) {\n      super.removeAllListeners(eventName)\n    } else {\n      super.removeAllListeners()\n    }\n    // re-add internal events\n    this._setupInternalEvents()\n    // trigger stop check just in case\n    this._onRemoveListener()\n  }\n\n  //\n  // to be implemented in subclass\n  //\n\n  _start () {\n    // default behavior is noop\n  }\n\n  _end () {\n    // default behavior is noop\n  }\n\n  //\n  // private\n  //\n\n  _setupInternalEvents () {\n    // first remove listeners for idempotence\n    this.removeListener('newListener', this._onNewListener)\n    this.removeListener('removeListener', this._onRemoveListener)\n    // then add them\n    this.on('newListener', this._onNewListener)\n    this.on('removeListener', this._onRemoveListener)\n  }\n\n  _onNewListener (eventName, handler) {\n    // `newListener` is called *before* the listener is added\n    if (!blockTrackerEvents.includes(eventName)) return\n    this._maybeStart()\n  }\n\n  _onRemoveListener (eventName, handler) {\n    // `removeListener` is called *after* the listener is removed\n    if (this._getBlockTrackerEventCount() > 0) return\n    this._maybeEnd()\n  }\n\n  _maybeStart () {\n    if (this._isRunning) return\n    this._isRunning = true\n    // cancel setting latest block to stale\n    this._cancelBlockResetTimeout()\n    this._start()\n  }\n\n  _maybeEnd () {\n    if (!this._isRunning) return\n    this._isRunning = false\n    this._setupBlockResetTimeout()\n    this._end()\n  }\n\n  _getBlockTrackerEventCount () {\n    return blockTrackerEvents\n      .map(eventName => this.listenerCount(eventName))\n      .reduce(calculateSum)\n  }\n\n  _newPotentialLatest (newBlock) {\n    const currentBlock = this._currentBlock\n    // only update if blok number is higher\n    if (currentBlock && (hexToInt(newBlock) <= hexToInt(currentBlock))) return\n    this._setCurrentBlock(newBlock)\n  }\n\n  _setCurrentBlock (newBlock) {\n    const oldBlock = this._currentBlock\n    this._currentBlock = newBlock\n    this.emit('latest', newBlock)\n    this.emit('sync', { oldBlock, newBlock })\n  }\n\n  _setupBlockResetTimeout () {\n    // clear any existing timeout\n    this._cancelBlockResetTimeout()\n    // clear latest block when stale\n    this._blockResetTimeout = setTimeout(this._resetCurrentBlock, this._blockResetDuration)\n    // nodejs - dont hold process open\n    if (this._blockResetTimeout.unref) {\n      this._blockResetTimeout.unref()\n    }\n  }\n\n  _cancelBlockResetTimeout () {\n    clearTimeout(this._blockResetTimeout)\n  }\n\n  _resetCurrentBlock () {\n    this._currentBlock = null\n  }\n\n}\n\nmodule.exports = BaseBlockTracker\n\nfunction hexToInt(hexInt) {\n  return Number.parseInt(hexInt, 16)\n}\n","var getPrototypeOf = require(\"./getPrototypeOf\");\n\nfunction _superPropBase(object, property) {\n  while (!Object.prototype.hasOwnProperty.call(object, property)) {\n    object = getPrototypeOf(object);\n    if (object === null) break;\n  }\n\n  return object;\n}\n\nmodule.exports = _superPropBase;","module.exports = IdIterator\n\nfunction IdIterator(opts){\n  opts = opts || {}\n  var max = opts.max || Number.MAX_SAFE_INTEGER\n  var idCounter = typeof opts.start !== 'undefined' ? opts.start : Math.floor(Math.random() * max)\n\n  return function createRandomId () {\n    idCounter = idCounter % max\n    return idCounter++\n  }\n\n}","const util = require('util')\nconst EventEmitter = require('events/')\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n}\n\nmodule.exports = SafeEventEmitter\n\n\nfunction SafeEventEmitter() {\n  EventEmitter.call(this)\n}\n\nutil.inherits(SafeEventEmitter, EventEmitter)\n\nSafeEventEmitter.prototype.emit = function (type) {\n  // copied from https://github.com/Gozala/events/blob/master/events.js\n  // modified lines are commented with \"edited:\"\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    // edited: using safeApply\n    safeApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      // edited: using safeApply\n      safeApply(listeners[i], this, args);\n  }\n\n  return true;\n}\n\nfunction safeApply(handler, context, args) {\n  try {\n    ReflectApply(handler, context, args)\n  } catch (err) {\n    // throw error after timeout so as not to interupt the stack\n    setTimeout(() => {\n      throw err\n    })\n  }\n}\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createIdRemapMiddleware = void 0;\nconst getUniqueId_1 = require(\"./getUniqueId\");\nfunction createIdRemapMiddleware() {\n    return (req, res, next, _end) => {\n        const originalId = req.id;\n        const newId = getUniqueId_1.getUniqueId();\n        req.id = newId;\n        res.id = newId;\n        next((done) => {\n            req.id = originalId;\n            res.id = originalId;\n            done();\n        });\n    };\n}\nexports.createIdRemapMiddleware = createIdRemapMiddleware;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWRSZW1hcE1pZGRsZXdhcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaWRSZW1hcE1pZGRsZXdhcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsK0NBQTRDO0FBRzVDLFNBQWdCLHVCQUF1QjtJQUNyQyxPQUFPLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUU7UUFDOUIsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUMxQixNQUFNLEtBQUssR0FBRyx5QkFBVyxFQUFFLENBQUM7UUFDNUIsR0FBRyxDQUFDLEVBQUUsR0FBRyxLQUFLLENBQUM7UUFDZixHQUFHLENBQUMsRUFBRSxHQUFHLEtBQUssQ0FBQztRQUNmLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ1osR0FBRyxDQUFDLEVBQUUsR0FBRyxVQUFVLENBQUM7WUFDcEIsR0FBRyxDQUFDLEVBQUUsR0FBRyxVQUFVLENBQUM7WUFDcEIsSUFBSSxFQUFFLENBQUM7UUFDVCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQztBQUNKLENBQUM7QUFaRCwwREFZQyJ9","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createAsyncMiddleware = void 0;\n/**\n * JsonRpcEngine only accepts callback-based middleware directly.\n * createAsyncMiddleware exists to enable consumers to pass in async middleware\n * functions.\n *\n * Async middleware have no \"end\" function. Instead, they \"end\" if they return\n * without calling \"next\". Rather than passing in explicit return handlers,\n * async middleware can simply await \"next\", and perform operations on the\n * response object when execution resumes.\n *\n * To accomplish this, createAsyncMiddleware passes the async middleware a\n * wrapped \"next\" function. That function calls the internal JsonRpcEngine\n * \"next\" function with a return handler that resolves a promise when called.\n *\n * The return handler will always be called. Its resolution of the promise\n * enables the control flow described above.\n */\nfunction createAsyncMiddleware(asyncMiddleware) {\n    return async (req, res, next, end) => {\n        // nextPromise is the key to the implementation\n        // it is resolved by the return handler passed to the\n        // \"next\" function\n        let resolveNextPromise;\n        const nextPromise = new Promise((resolve) => {\n            resolveNextPromise = resolve;\n        });\n        let returnHandlerCallback = null;\n        let nextWasCalled = false;\n        // This will be called by the consumer's async middleware.\n        const asyncNext = async () => {\n            nextWasCalled = true;\n            // We pass a return handler to next(). When it is called by the engine,\n            // the consumer's async middleware will resume executing.\n            // eslint-disable-next-line node/callback-return\n            next((runReturnHandlersCallback) => {\n                // This callback comes from JsonRpcEngine._runReturnHandlers\n                returnHandlerCallback = runReturnHandlersCallback;\n                resolveNextPromise();\n            });\n            await nextPromise;\n        };\n        try {\n            await asyncMiddleware(req, res, asyncNext);\n            if (nextWasCalled) {\n                await nextPromise; // we must wait until the return handler is called\n                returnHandlerCallback(null);\n            }\n            else {\n                end(null);\n            }\n        }\n        catch (error) {\n            if (returnHandlerCallback) {\n                returnHandlerCallback(error);\n            }\n            else {\n                end(error);\n            }\n        }\n    };\n}\nexports.createAsyncMiddleware = createAsyncMiddleware;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlQXN5bmNNaWRkbGV3YXJlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NyZWF0ZUFzeW5jTWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFnQkE7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7QUFDSCxTQUFnQixxQkFBcUIsQ0FDbkMsZUFBNkM7SUFFN0MsT0FBTyxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDbkMsK0NBQStDO1FBQy9DLHFEQUFxRDtRQUNyRCxrQkFBa0I7UUFDbEIsSUFBSSxrQkFBOEIsQ0FBQztRQUNuQyxNQUFNLFdBQVcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFO1lBQzFDLGtCQUFrQixHQUFHLE9BQU8sQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztRQUVILElBQUkscUJBQXFCLEdBQVksSUFBSSxDQUFDO1FBQzFDLElBQUksYUFBYSxHQUFHLEtBQUssQ0FBQztRQUUxQiwwREFBMEQ7UUFDMUQsTUFBTSxTQUFTLEdBQUcsS0FBSyxJQUFJLEVBQUU7WUFDM0IsYUFBYSxHQUFHLElBQUksQ0FBQztZQUVyQix1RUFBdUU7WUFDdkUseURBQXlEO1lBQ3pELGdEQUFnRDtZQUNoRCxJQUFJLENBQUMsQ0FBQyx5QkFBeUIsRUFBRSxFQUFFO2dCQUNqQyw0REFBNEQ7Z0JBQzVELHFCQUFxQixHQUFHLHlCQUF5QixDQUFDO2dCQUNsRCxrQkFBa0IsRUFBRSxDQUFDO1lBQ3ZCLENBQUMsQ0FBQyxDQUFDO1lBQ0gsTUFBTSxXQUFXLENBQUM7UUFDcEIsQ0FBQyxDQUFDO1FBRUYsSUFBSTtZQUNGLE1BQU0sZUFBZSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFFM0MsSUFBSSxhQUFhLEVBQUU7Z0JBQ2pCLE1BQU0sV0FBVyxDQUFDLENBQUMsa0RBQWtEO2dCQUNwRSxxQkFBK0MsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN4RDtpQkFBTTtnQkFDTCxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDWDtTQUNGO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxJQUFJLHFCQUFxQixFQUFFO2dCQUN4QixxQkFBK0MsQ0FBQyxLQUFLLENBQUMsQ0FBQzthQUN6RDtpQkFBTTtnQkFDTCxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDWjtTQUNGO0lBQ0gsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQS9DRCxzREErQ0MifQ==","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createScaffoldMiddleware = void 0;\nfunction createScaffoldMiddleware(handlers) {\n    return (req, res, next, end) => {\n        const handler = handlers[req.method];\n        // if no handler, return\n        if (handler === undefined) {\n            return next();\n        }\n        // if handler is fn, call as middleware\n        if (typeof handler === 'function') {\n            return handler(req, res, next, end);\n        }\n        // if handler is some other value, use as result\n        res.result = handler;\n        return end();\n    };\n}\nexports.createScaffoldMiddleware = createScaffoldMiddleware;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlU2NhZmZvbGRNaWRkbGV3YXJlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NyZWF0ZVNjYWZmb2xkTWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFJQSxTQUFnQix3QkFBd0IsQ0FBQyxRQUV4QztJQUNDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUM3QixNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3JDLHdCQUF3QjtRQUN4QixJQUFJLE9BQU8sS0FBSyxTQUFTLEVBQUU7WUFDekIsT0FBTyxJQUFJLEVBQUUsQ0FBQztTQUNmO1FBQ0QsdUNBQXVDO1FBQ3ZDLElBQUksT0FBTyxPQUFPLEtBQUssVUFBVSxFQUFFO1lBQ2pDLE9BQU8sT0FBTyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ3JDO1FBQ0QsZ0RBQWdEO1FBQy9DLEdBQStCLENBQUMsTUFBTSxHQUFHLE9BQU8sQ0FBQztRQUNsRCxPQUFPLEdBQUcsRUFBRSxDQUFDO0lBQ2YsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQWpCRCw0REFpQkMifQ==","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./idRemapMiddleware\"), exports);\n__exportStar(require(\"./createAsyncMiddleware\"), exports);\n__exportStar(require(\"./createScaffoldMiddleware\"), exports);\n__exportStar(require(\"./getUniqueId\"), exports);\n__exportStar(require(\"./JsonRpcEngine\"), exports);\n__exportStar(require(\"./mergeMiddleware\"), exports);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUEsc0RBQW9DO0FBQ3BDLDBEQUF3QztBQUN4Qyw2REFBMkM7QUFDM0MsZ0RBQThCO0FBQzlCLGtEQUFnQztBQUNoQyxvREFBa0MifQ==","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ethErrors = void 0;\nconst classes_1 = require(\"./classes\");\nconst utils_1 = require(\"./utils\");\nconst error_constants_1 = require(\"./error-constants\");\nexports.ethErrors = {\n    rpc: {\n        /**\n         * Get a JSON RPC 2.0 Parse (-32700) error.\n         */\n        parse: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.parse, arg),\n        /**\n         * Get a JSON RPC 2.0 Invalid Request (-32600) error.\n         */\n        invalidRequest: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.invalidRequest, arg),\n        /**\n         * Get a JSON RPC 2.0 Invalid Params (-32602) error.\n         */\n        invalidParams: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.invalidParams, arg),\n        /**\n         * Get a JSON RPC 2.0 Method Not Found (-32601) error.\n         */\n        methodNotFound: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.methodNotFound, arg),\n        /**\n         * Get a JSON RPC 2.0 Internal (-32603) error.\n         */\n        internal: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.internal, arg),\n        /**\n         * Get a JSON RPC 2.0 Server error.\n         * Permits integer error codes in the [ -32099 <= -32005 ] range.\n         * Codes -32000 through -32004 are reserved by EIP-1474.\n         */\n        server: (opts) => {\n            if (!opts || typeof opts !== 'object' || Array.isArray(opts)) {\n                throw new Error('Ethereum RPC Server errors must provide single object argument.');\n            }\n            const { code } = opts;\n            if (!Number.isInteger(code) || code > -32005 || code < -32099) {\n                throw new Error('\"code\" must be an integer such that: -32099 <= code <= -32005');\n            }\n            return getEthJsonRpcError(code, opts);\n        },\n        /**\n         * Get an Ethereum JSON RPC Invalid Input (-32000) error.\n         */\n        invalidInput: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.invalidInput, arg),\n        /**\n         * Get an Ethereum JSON RPC Resource Not Found (-32001) error.\n         */\n        resourceNotFound: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.resourceNotFound, arg),\n        /**\n         * Get an Ethereum JSON RPC Resource Unavailable (-32002) error.\n         */\n        resourceUnavailable: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.resourceUnavailable, arg),\n        /**\n         * Get an Ethereum JSON RPC Transaction Rejected (-32003) error.\n         */\n        transactionRejected: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.transactionRejected, arg),\n        /**\n         * Get an Ethereum JSON RPC Method Not Supported (-32004) error.\n         */\n        methodNotSupported: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.methodNotSupported, arg),\n        /**\n         * Get an Ethereum JSON RPC Limit Exceeded (-32005) error.\n         */\n        limitExceeded: (arg) => getEthJsonRpcError(error_constants_1.errorCodes.rpc.limitExceeded, arg),\n    },\n    provider: {\n        /**\n         * Get an Ethereum Provider User Rejected Request (4001) error.\n         */\n        userRejectedRequest: (arg) => {\n            return getEthProviderError(error_constants_1.errorCodes.provider.userRejectedRequest, arg);\n        },\n        /**\n         * Get an Ethereum Provider Unauthorized (4100) error.\n         */\n        unauthorized: (arg) => {\n            return getEthProviderError(error_constants_1.errorCodes.provider.unauthorized, arg);\n        },\n        /**\n         * Get an Ethereum Provider Unsupported Method (4200) error.\n         */\n        unsupportedMethod: (arg) => {\n            return getEthProviderError(error_constants_1.errorCodes.provider.unsupportedMethod, arg);\n        },\n        /**\n         * Get an Ethereum Provider Not Connected (4900) error.\n         */\n        disconnected: (arg) => {\n            return getEthProviderError(error_constants_1.errorCodes.provider.disconnected, arg);\n        },\n        /**\n         * Get an Ethereum Provider Chain Not Connected (4901) error.\n         */\n        chainDisconnected: (arg) => {\n            return getEthProviderError(error_constants_1.errorCodes.provider.chainDisconnected, arg);\n        },\n        /**\n         * Get a custom Ethereum Provider error.\n         */\n        custom: (opts) => {\n            if (!opts || typeof opts !== 'object' || Array.isArray(opts)) {\n                throw new Error('Ethereum Provider custom errors must provide single object argument.');\n            }\n            const { code, message, data } = opts;\n            if (!message || typeof message !== 'string') {\n                throw new Error('\"message\" must be a nonempty string');\n            }\n            return new classes_1.EthereumProviderError(code, message, data);\n        },\n    },\n};\n// Internal\nfunction getEthJsonRpcError(code, arg) {\n    const [message, data] = parseOpts(arg);\n    return new classes_1.EthereumRpcError(code, message || utils_1.getMessageFromCode(code), data);\n}\nfunction getEthProviderError(code, arg) {\n    const [message, data] = parseOpts(arg);\n    return new classes_1.EthereumProviderError(code, message || utils_1.getMessageFromCode(code), data);\n}\nfunction parseOpts(arg) {\n    if (arg) {\n        if (typeof arg === 'string') {\n            return [arg];\n        }\n        else if (typeof arg === 'object' && !Array.isArray(arg)) {\n            const { message, data } = arg;\n            if (message && typeof message !== 'string') {\n                throw new Error('Must specify string message.');\n            }\n            return [message || undefined, data];\n        }\n    }\n    return [];\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3JzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2Vycm9ycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx1Q0FBb0U7QUFDcEUsbUNBQTZDO0FBQzdDLHVEQUErQztBQWVsQyxRQUFBLFNBQVMsR0FBRztJQUN2QixHQUFHLEVBQUU7UUFFSDs7V0FFRztRQUNILEtBQUssRUFBRSxDQUFJLEdBQXFCLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUNyRCw0QkFBVSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUMxQjtRQUVEOztXQUVHO1FBQ0gsY0FBYyxFQUFFLENBQUksR0FBcUIsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQzlELDRCQUFVLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQ25DO1FBRUQ7O1dBRUc7UUFDSCxhQUFhLEVBQUUsQ0FBSSxHQUFxQixFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FDN0QsNEJBQVUsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FDbEM7UUFFRDs7V0FFRztRQUNILGNBQWMsRUFBRSxDQUFJLEdBQXFCLEVBQUUsRUFBRSxDQUFDLGtCQUFrQixDQUM5RCw0QkFBVSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsR0FBRyxDQUNuQztRQUVEOztXQUVHO1FBQ0gsUUFBUSxFQUFFLENBQUksR0FBcUIsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQ3hELDRCQUFVLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQzdCO1FBRUQ7Ozs7V0FJRztRQUNILE1BQU0sRUFBRSxDQUFJLElBQTJCLEVBQUUsRUFBRTtZQUN6QyxJQUFJLENBQUMsSUFBSSxJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUM1RCxNQUFNLElBQUksS0FBSyxDQUFDLGlFQUFpRSxDQUFDLENBQUM7YUFDcEY7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","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.mergeMiddleware = void 0;\nconst JsonRpcEngine_1 = require(\"./JsonRpcEngine\");\nfunction mergeMiddleware(middlewareStack) {\n    const engine = new JsonRpcEngine_1.JsonRpcEngine();\n    middlewareStack.forEach((middleware) => engine.push(middleware));\n    return engine.asMiddleware();\n}\nexports.mergeMiddleware = mergeMiddleware;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVyZ2VNaWRkbGV3YXJlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL21lcmdlTWlkZGxld2FyZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxtREFBbUU7QUFFbkUsU0FBZ0IsZUFBZSxDQUFDLGVBQXNEO0lBQ3BGLE1BQU0sTUFBTSxHQUFHLElBQUksNkJBQWEsRUFBRSxDQUFDO0lBQ25DLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUNqRSxPQUFPLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUMvQixDQUFDO0FBSkQsMENBSUMifQ==","module.exports = function createScaffoldMiddleware (handlers) {\n  return (req, res, next, end) => {\n    const handler = handlers[req.method]\n    // if no handler, return\n    if (handler === undefined) {\n      return next()\n    }\n    // if handler is fn, call as middleware\n    if (typeof handler === 'function') {\n      return handler(req, res, next, end)\n    }\n    // if handler is some other value, use as result\n    res.result = handler\n    return end()\n  }\n}\n","const EthQuery = require('eth-query')\nconst pify = require('pify')\nconst BaseFilterWithHistory = require('./base-filter-history')\nconst { bnToHex, hexToInt, incrementHexInt, minBlockRef, blockRefIsNumber } = require('./hexUtils')\n\nclass LogFilter extends BaseFilterWithHistory {\n\n  constructor ({ provider, params }) {\n    super()\n    this.type = 'log'\n    this.ethQuery = new EthQuery(provider)\n    this.params = Object.assign({\n      fromBlock: 'latest',\n      toBlock: 'latest',\n      address: undefined,\n      topics: [],\n    }, params)\n    // normalize address parameter\n    if (this.params.address) {\n      // ensure array\n      if (!Array.isArray(this.params.address)) {\n        this.params.address = [this.params.address]\n      }\n      // ensure lowercase\n      this.params.address = this.params.address.map(address => address.toLowerCase())\n    }\n  }\n\n  async initialize({ currentBlock }) {\n    // resolve params.fromBlock\n    let fromBlock = this.params.fromBlock\n    if (['latest', 'pending'].includes(fromBlock)) fromBlock = currentBlock\n    if ('earliest' === fromBlock) fromBlock = '0x0'\n    this.params.fromBlock = fromBlock\n    // set toBlock for initial lookup\n    const toBlock = minBlockRef(this.params.toBlock, currentBlock)\n    const params = Object.assign({}, this.params, { toBlock })\n    // fetch logs and add to results\n    const newLogs = await this._fetchLogs(params)\n    this.addInitialResults(newLogs)\n  }\n\n  async update ({ oldBlock, newBlock }) {\n    // configure params for this update\n    const toBlock = newBlock\n    let fromBlock\n    // oldBlock is empty on first sync\n    if (oldBlock) {\n      fromBlock = incrementHexInt(oldBlock)\n    } else {\n      fromBlock = newBlock\n    }\n    // fetch logs\n    const params = Object.assign({}, this.params, { fromBlock, toBlock })\n    const newLogs = await this._fetchLogs(params)\n    const matchingLogs = newLogs.filter(log => this.matchLog(log))\n\n    // add to results\n    this.addResults(matchingLogs)\n  }\n\n  async _fetchLogs (params) {\n    const newLogs = await pify(cb => this.ethQuery.getLogs(params, cb))()\n    // add to results\n    return newLogs\n  }\n\n  matchLog(log) {\n    // check if block number in bounds:\n    if (hexToInt(this.params.fromBlock) >= hexToInt(log.blockNumber)) return false\n    if (blockRefIsNumber(this.params.toBlock) && hexToInt(this.params.toBlock) <= hexToInt(log.blockNumber)) return false\n\n    // address is correct:\n    const normalizedLogAddress = log.address && log.address.toLowerCase()\n    if (this.params.address && normalizedLogAddress && !this.params.address.includes(normalizedLogAddress)) return false\n\n    // topics match:\n    // topics are position-dependant\n    // topics can be nested to represent `or` [[a || b], c]\n    // topics can be null, representing a wild card for that position\n    const topicsMatch = this.params.topics.every((topicPattern, index) => {\n      // pattern is longer than actual topics\n      let logTopic = log.topics[index]\n      if (!logTopic) return false\n      logTopic = logTopic.toLowerCase()\n      // normalize subTopics\n      let subtopicsToMatch = Array.isArray(topicPattern) ? topicPattern : [topicPattern]\n      // check for wild card\n      const subtopicsIncludeWildcard = subtopicsToMatch.includes(null)\n      if (subtopicsIncludeWildcard) return true\n      subtopicsToMatch = subtopicsToMatch.map(topic => topic.toLowerCase())\n      // check each possible matching topic\n      const topicDoesMatch = subtopicsToMatch.includes(logTopic)\n      return topicDoesMatch\n    })\n\n    return topicsMatch\n  }\n\n}\n\nmodule.exports = LogFilter\n","'use strict';\n\nconst processFn = (fn, options, proxy, unwrapped) => function (...arguments_) {\n\tconst P = options.promiseModule;\n\n\treturn new P((resolve, reject) => {\n\t\tif (options.multiArgs) {\n\t\t\targuments_.push((...result) => {\n\t\t\t\tif (options.errorFirst) {\n\t\t\t\t\tif (result[0]) {\n\t\t\t\t\t\treject(result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.shift();\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tresolve(result);\n\t\t\t\t}\n\t\t\t});\n\t\t} else if (options.errorFirst) {\n\t\t\targuments_.push((error, result) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treject(error);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(result);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\targuments_.push(resolve);\n\t\t}\n\n\t\tconst self = this === proxy ? unwrapped : this;\n\t\tReflect.apply(fn, self, arguments_);\n\t});\n};\n\nconst filterCache = new WeakMap();\n\nmodule.exports = (input, options) => {\n\toptions = {\n\t\texclude: [/.+(?:Sync|Stream)$/],\n\t\terrorFirst: true,\n\t\tpromiseModule: Promise,\n\t\t...options\n\t};\n\n\tconst objectType = typeof input;\n\tif (!(input !== null && (objectType === 'object' || objectType === 'function'))) {\n\t\tthrow new TypeError(`Expected \\`input\\` to be a \\`Function\\` or \\`Object\\`, got \\`${input === null ? 'null' : objectType}\\``);\n\t}\n\n\tconst filter = (target, key) => {\n\t\tlet cached = filterCache.get(target);\n\n\t\tif (!cached) {\n\t\t\tcached = {};\n\t\t\tfilterCache.set(target, cached);\n\t\t}\n\n\t\tif (key in cached) {\n\t\t\treturn cached[key];\n\t\t}\n\n\t\tconst match = pattern => (typeof pattern === 'string' || typeof key === 'symbol') ? key === pattern : pattern.test(key);\n\t\tconst desc = Reflect.getOwnPropertyDescriptor(target, key);\n\t\tconst writableOrConfigurableOwn = (desc === undefined || desc.writable || desc.configurable);\n\t\tconst included = options.include ? options.include.some(match) : !options.exclude.some(match);\n\t\tconst shouldFilter = included && writableOrConfigurableOwn;\n\t\tcached[key] = shouldFilter;\n\t\treturn shouldFilter;\n\t};\n\n\tconst cache = new WeakMap();\n\n\tconst proxy = new Proxy(input, {\n\t\tapply(target, thisArg, args) {\n\t\t\tconst cached = cache.get(target);\n\n\t\t\tif (cached) {\n\t\t\t\treturn Reflect.apply(cached, thisArg, args);\n\t\t\t}\n\n\t\t\tconst pified = options.excludeMain ? target : processFn(target, options, proxy, target);\n\t\t\tcache.set(target, pified);\n\t\t\treturn Reflect.apply(pified, thisArg, args);\n\t\t},\n\n\t\tget(target, key) {\n\t\t\tconst property = target[key];\n\n\t\t\t// eslint-disable-next-line no-use-extend-native/no-use-extend-native\n\t\t\tif (!filter(target, key) || property === Function.prototype[key]) {\n\t\t\t\treturn property;\n\t\t\t}\n\n\t\t\tconst cached = cache.get(property);\n\n\t\t\tif (cached) {\n\t\t\t\treturn cached;\n\t\t\t}\n\n\t\t\tif (typeof property === 'function') {\n\t\t\t\tconst pified = processFn(property, options, proxy, target);\n\t\t\t\tcache.set(property, pified);\n\t\t\t\treturn pified;\n\t\t\t}\n\n\t\t\treturn property;\n\t\t}\n\t});\n\n\treturn proxy;\n};\n","const BaseFilter = require('./base-filter')\n\n// tracks all results ever recorded\nclass BaseFilterWithHistory extends BaseFilter {\n\n  constructor () {\n    super()\n    this.allResults = []\n  }\n\n  async update () {\n    throw new Error('BaseFilterWithHistory - no update method specified')\n  }\n\n  addResults (newResults) {\n    this.allResults = this.allResults.concat(newResults)\n    super.addResults(newResults)\n  }\n\n  addInitialResults (newResults) {\n    this.allResults = this.allResults.concat(newResults)\n    super.addInitialResults(newResults)\n  }\n\n  getAllResults () {\n    return this.allResults\n  }\n\n}\n\nmodule.exports = BaseFilterWithHistory","const BaseFilter = require('./base-filter')\nconst getBlocksForRange = require('./getBlocksForRange')\nconst { incrementHexInt } = require('./hexUtils')\n\nclass BlockFilter extends BaseFilter {\n\n  constructor ({ provider, params }) {\n    super()\n    this.type = 'block'\n    this.provider = provider\n  }\n\n  async update ({ oldBlock, newBlock }) {\n    const toBlock = newBlock\n    const fromBlock = incrementHexInt(oldBlock)\n    const blockBodies = await getBlocksForRange({ provider: this.provider, fromBlock, toBlock })\n    const blockHashes = blockBodies.map((block) => block.hash)\n    this.addResults(blockHashes)\n  }\n\n}\n\nmodule.exports = BlockFilter\n","const BaseFilter = require('./base-filter')\nconst getBlocksForRange = require('./getBlocksForRange')\nconst { incrementHexInt } = require('./hexUtils')\n\nclass TxFilter extends BaseFilter {\n\n  constructor ({ provider }) {\n    super()\n    this.type = 'tx'\n    this.provider = provider\n  }\n\n  async update ({ oldBlock }) {\n    const toBlock = oldBlock\n    const fromBlock = incrementHexInt(oldBlock)\n    const blocks = await getBlocksForRange({ provider: this.provider, fromBlock, toBlock })\n    const blockTxHashes = []\n    for (const block of blocks) {\n      blockTxHashes.push(...block.transactions)\n    }\n    // add to results\n    this.addResults(blockTxHashes)\n  }\n\n}\n\nmodule.exports = TxFilter\n","import { __awaiter, __generator } from \"tslib\";\nvar Semaphore = /** @class */ (function () {\n    function Semaphore(_maxConcurrency) {\n        this._maxConcurrency = _maxConcurrency;\n        this._queue = [];\n        if (_maxConcurrency <= 0) {\n            throw new Error('semaphore must be initialized to a positive value');\n        }\n        this._value = _maxConcurrency;\n    }\n    Semaphore.prototype.acquire = function () {\n        var _this = this;\n        var locked = this.isLocked();\n        var ticket = new Promise(function (r) { return _this._queue.push(r); });\n        if (!locked)\n            this._dispatch();\n        return ticket;\n    };\n    Semaphore.prototype.runExclusive = function (callback) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, value, release;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this.acquire()];\n                    case 1:\n                        _a = _b.sent(), value = _a[0], release = _a[1];\n                        _b.label = 2;\n                    case 2:\n                        _b.trys.push([2, , 4, 5]);\n                        return [4 /*yield*/, callback(value)];\n                    case 3: return [2 /*return*/, _b.sent()];\n                    case 4:\n                        release();\n                        return [7 /*endfinally*/];\n                    case 5: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Semaphore.prototype.isLocked = function () {\n        return this._value <= 0;\n    };\n    Semaphore.prototype.release = function () {\n        if (this._maxConcurrency > 1) {\n            throw new Error('this method is unavailabel on semaphores with concurrency > 1; use the scoped release returned by acquire instead');\n        }\n        if (this._currentReleaser) {\n            var releaser = this._currentReleaser;\n            this._currentReleaser = undefined;\n            releaser();\n        }\n    };\n    Semaphore.prototype._dispatch = function () {\n        var _this = this;\n        var nextConsumer = this._queue.shift();\n        if (!nextConsumer)\n            return;\n        var released = false;\n        this._currentReleaser = function () {\n            if (released)\n                return;\n            released = true;\n            _this._value++;\n            _this._dispatch();\n        };\n        nextConsumer([this._value--, this._currentReleaser]);\n    };\n    return Semaphore;\n}());\nexport default Semaphore;\n","import { __awaiter, __generator } from \"tslib\";\nimport Semaphore from './Semaphore';\nvar Mutex = /** @class */ (function () {\n    function Mutex() {\n        this._semaphore = new Semaphore(1);\n    }\n    Mutex.prototype.acquire = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, releaser;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, this._semaphore.acquire()];\n                    case 1:\n                        _a = _b.sent(), releaser = _a[1];\n                        return [2 /*return*/, releaser];\n                }\n            });\n        });\n    };\n    Mutex.prototype.runExclusive = function (callback) {\n        return this._semaphore.runExclusive(function () { return callback(); });\n    };\n    Mutex.prototype.isLocked = function () {\n        return this._semaphore.isLocked();\n    };\n    Mutex.prototype.release = function () {\n        this._semaphore.release();\n    };\n    return Mutex;\n}());\nexport default Mutex;\n","import { __awaiter, __generator } from \"tslib\";\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function withTimeout(sync, timeout, timeoutError) {\n    var _this = this;\n    if (timeoutError === void 0) { timeoutError = new Error('timeout'); }\n    return {\n        acquire: function () {\n            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {\n                var isTimeout, ticket, release;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            isTimeout = false;\n                            setTimeout(function () {\n                                isTimeout = true;\n                                reject(timeoutError);\n                            }, timeout);\n                            return [4 /*yield*/, sync.acquire()];\n                        case 1:\n                            ticket = _a.sent();\n                            if (isTimeout) {\n                                release = Array.isArray(ticket) ? ticket[1] : ticket;\n                                release();\n                            }\n                            else {\n                                resolve(ticket);\n                            }\n                            return [2 /*return*/];\n                    }\n                });\n            }); });\n        },\n        runExclusive: function (callback) {\n            return __awaiter(this, void 0, void 0, function () {\n                var release, ticket;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            release = function () { return undefined; };\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, , 7, 8]);\n                            return [4 /*yield*/, this.acquire()];\n                        case 2:\n                            ticket = _a.sent();\n                            if (!Array.isArray(ticket)) return [3 /*break*/, 4];\n                            release = ticket[1];\n                            return [4 /*yield*/, callback(ticket[0])];\n                        case 3: return [2 /*return*/, _a.sent()];\n                        case 4:\n                            release = ticket;\n                            return [4 /*yield*/, callback()];\n                        case 5: return [2 /*return*/, _a.sent()];\n                        case 6: return [3 /*break*/, 8];\n                        case 7:\n                            release();\n                            return [7 /*endfinally*/];\n                        case 8: return [2 /*return*/];\n                    }\n                });\n            });\n        },\n        release: function () {\n            sync.release();\n        },\n        isLocked: function () { return sync.isLocked(); },\n    };\n}\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nmodule.exports = _asyncToGenerator;","var arrayWithoutHoles = require(\"./arrayWithoutHoles\");\n\nvar iterableToArray = require(\"./iterableToArray\");\n\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray\");\n\nvar nonIterableSpread = require(\"./nonIterableSpread\");\n\nfunction _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}\n\nmodule.exports = _toConsumableArray;","\nmodule.exports = {\n  minBlockRef,\n  maxBlockRef,\n  sortBlockRefs,\n  bnToHex,\n  blockRefIsNumber,\n  hexToInt,\n  incrementHexInt,\n  intToHex,\n  unsafeRandomBytes,\n}\n\nfunction minBlockRef(...refs) {\n  const sortedRefs = sortBlockRefs(refs)\n  return sortedRefs[0]\n}\n\nfunction maxBlockRef(...refs) {\n  const sortedRefs = sortBlockRefs(refs)\n  return sortedRefs[sortedRefs.length-1]\n}\n\nfunction sortBlockRefs(refs) {\n  return refs.sort((refA, refB) => {\n    if (refA === 'latest' || refB === 'earliest') return 1\n    if (refB === 'latest' || refA === 'earliest') return -1\n    return hexToInt(refA) - hexToInt(refB)\n  })\n}\n\nfunction bnToHex(bn) {\n  return '0x' + bn.toString(16)\n}\n\nfunction blockRefIsNumber(blockRef){\n  return blockRef && !['earliest', 'latest', 'pending'].includes(blockRef)\n}\n\nfunction hexToInt(hexString) {\n  if (hexString === undefined || hexString === null) return hexString\n  return Number.parseInt(hexString, 16)\n}\n\nfunction incrementHexInt(hexString){\n  if (hexString === undefined || hexString === null) return hexString\n  const value = hexToInt(hexString)\n  return intToHex(value + 1)\n}\n\nfunction intToHex(int) {\n  if (int === undefined || int === null) return int\n  let hexString = int.toString(16)\n  const needsLeftPad = hexString.length % 2\n  if (needsLeftPad) hexString = '0' + hexString\n  return '0x' + hexString\n}\n\nfunction unsafeRandomBytes(byteCount) {\n  let result = '0x'\n  for (let i = 0; i < byteCount; i++) {\n    result += unsafeRandomNibble()\n    result += unsafeRandomNibble()\n  }\n  return result\n}\n\nfunction unsafeRandomNibble() {\n  return Math.floor(Math.random() * 16).toString(16)\n}\n","module.exports = extend\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction extend() {\n    var target = {}\n\n    for (var i = 0; i < arguments.length; i++) {\n        var source = arguments[i]\n\n        for (var key in source) {\n            if (hasOwnProperty.call(source, key)) {\n                target[key] = source[key]\n            }\n        }\n    }\n\n    return target\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst events_1 = require(\"events\");\nfunction safeApply(handler, context, args) {\n    try {\n        Reflect.apply(handler, context, args);\n    }\n    catch (err) {\n        // Throw error after timeout so as not to interrupt the stack\n        setTimeout(() => {\n            throw err;\n        });\n    }\n}\nfunction arrayClone(arr) {\n    const n = arr.length;\n    const copy = new Array(n);\n    for (let i = 0; i < n; i += 1) {\n        copy[i] = arr[i];\n    }\n    return copy;\n}\nclass SafeEventEmitter extends events_1.EventEmitter {\n    emit(type, ...args) {\n        let doError = type === 'error';\n        const events = this._events;\n        if (events !== undefined) {\n            doError = doError && events.error === undefined;\n        }\n        else if (!doError) {\n            return false;\n        }\n        // If there is no 'error' event listener then throw.\n        if (doError) {\n            let er;\n            if (args.length > 0) {\n                [er] = args;\n            }\n            if (er instanceof Error) {\n                // Note: The comments on the `throw` lines are intentional, they show\n                // up in Node's output if this results in an unhandled exception.\n                throw er; // Unhandled 'error' event\n            }\n            // At least give some kind of context to the user\n            const err = new Error(`Unhandled error.${er ? ` (${er.message})` : ''}`);\n            err.context = er;\n            throw err; // Unhandled 'error' event\n        }\n        const handler = events[type];\n        if (handler === undefined) {\n            return false;\n        }\n        if (typeof handler === 'function') {\n            safeApply(handler, this, args);\n        }\n        else {\n            const len = handler.length;\n            const listeners = arrayClone(handler);\n            for (let i = 0; i < len; i += 1) {\n                safeApply(listeners[i], this, args);\n            }\n        }\n        return true;\n    }\n}\nexports.default = SafeEventEmitter;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.EthereumProviderError = exports.EthereumRpcError = void 0;\nconst fast_safe_stringify_1 = require(\"fast-safe-stringify\");\n/**\n * Error subclass implementing JSON RPC 2.0 errors and Ethereum RPC errors\n * per EIP-1474.\n * Permits any integer error code.\n */\nclass EthereumRpcError extends Error {\n    constructor(code, message, data) {\n        if (!Number.isInteger(code)) {\n            throw new Error('\"code\" must be an integer.');\n        }\n        if (!message || typeof message !== 'string') {\n            throw new Error('\"message\" must be a nonempty string.');\n        }\n        super(message);\n        this.code = code;\n        if (data !== undefined) {\n            this.data = data;\n        }\n    }\n    /**\n     * Returns a plain object with all public class properties.\n     */\n    serialize() {\n        const serialized = {\n            code: this.code,\n            message: this.message,\n        };\n        if (this.data !== undefined) {\n            serialized.data = this.data;\n        }\n        if (this.stack) {\n            serialized.stack = this.stack;\n        }\n        return serialized;\n    }\n    /**\n     * Return a string representation of the serialized error, omitting\n     * any circular references.\n     */\n    toString() {\n        return fast_safe_stringify_1.default(this.serialize(), stringifyReplacer, 2);\n    }\n}\nexports.EthereumRpcError = EthereumRpcError;\n/**\n * Error subclass implementing Ethereum Provider errors per EIP-1193.\n * Permits integer error codes in the [ 1000 <= 4999 ] range.\n */\nclass EthereumProviderError extends EthereumRpcError {\n    /**\n     * Create an Ethereum Provider JSON-RPC error.\n     * `code` must be an integer in the 1000 <= 4999 range.\n     */\n    constructor(code, message, data) {\n        if (!isValidEthProviderCode(code)) {\n            throw new Error('\"code\" must be an integer such that: 1000 <= code <= 4999');\n        }\n        super(code, message, data);\n    }\n}\nexports.EthereumProviderError = EthereumProviderError;\n// Internal\nfunction isValidEthProviderCode(code) {\n    return Number.isInteger(code) && code >= 1000 && code <= 4999;\n}\nfunction stringifyReplacer(_, value) {\n    if (value === '[Circular]') {\n        return undefined;\n    }\n    return value;\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xhc3Nlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGFzc2VzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZEQUFnRDtBQVNoRDs7OztHQUlHO0FBQ0gsTUFBYSxnQkFBb0IsU0FBUSxLQUFLO0lBTTVDLFlBQVksSUFBWSxFQUFFLE9BQWUsRUFBRSxJQUFRO1FBRWpELElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzNCLE1BQU0sSUFBSSxLQUFLLENBQ2IsNEJBQTRCLENBQzdCLENBQUM7U0FDSDtRQUNELElBQUksQ0FBQyxPQUFPLElBQUksT0FBTyxPQUFPLEtBQUssUUFBUSxFQUFFO1lBQzNDLE1BQU0sSUFBSSxLQUFLLENBQ2Isc0NBQXNDLENBQ3ZDLENBQUM7U0FDSDtRQUVELEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLElBQUksSUFBSSxLQUFLLFNBQVMsRUFBRTtZQUN0QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztTQUNsQjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILFNBQVM7UUFDUCxNQUFNLFVBQVUsR0FBK0I7WUFDN0MsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsT0FBTyxFQUFFLElBQUksQ0FBQyxPQUFPO1NBQ3RCLENBQUM7UUFDRixJQUFJLElBQUksQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFO1lBQzNCLFVBQVUsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztTQUM3QjtRQUNELElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNkLFVBQVUsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztTQUMvQjtRQUNELE9BQU8sVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxRQUFRO1FBQ04sT0FBTyw2QkFBYSxDQUNsQixJQUFJLENBQUMsU0FBUyxFQUFFLEVBQ2hCLGlCQUFpQixFQUNqQixDQUFDLENBQ0YsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQXRERCw0Q0FzREM7QUFFRDs7O0dBR0c7QUFDSCxNQUFhLHFCQUF5QixTQUFRLGdCQUFtQjtJQUUvRDs7O09BR0c7SUFDSCxZQUFZLElBQVksRUFBRSxPQUFlLEVBQUUsSUFBUTtRQUVqRCxJQUFJLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDakMsTUFBTSxJQUFJLEtBQUssQ0FDYiwyREFBMkQsQ0FDNUQsQ0FBQztTQUNIO1FBRUQsS0FBSyxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztDQUNGO0FBaEJELHNEQWdCQztBQUVELFdBQVc7QUFFWCxTQUFTLHNCQUFzQixDQUFDLElBQVk7SUFDMUMsT0FBTyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQztBQUNoRSxDQUFDO0FBRUQsU0FBUyxpQkFBaUIsQ0FBQyxDQUFVLEVBQUUsS0FBYztJQUNuRCxJQUFJLEtBQUssS0FBSyxZQUFZLEVBQUU7UUFDMUIsT0FBTyxTQUFTLENBQUM7S0FDbEI7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNmLENBQUMifQ==","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.errorValues = exports.errorCodes = void 0;\nexports.errorCodes = {\n    rpc: {\n        invalidInput: -32000,\n        resourceNotFound: -32001,\n        resourceUnavailable: -32002,\n        transactionRejected: -32003,\n        methodNotSupported: -32004,\n        limitExceeded: -32005,\n        parse: -32700,\n        invalidRequest: -32600,\n        methodNotFound: -32601,\n        invalidParams: -32602,\n        internal: -32603,\n    },\n    provider: {\n        userRejectedRequest: 4001,\n        unauthorized: 4100,\n        unsupportedMethod: 4200,\n        disconnected: 4900,\n        chainDisconnected: 4901,\n    },\n};\nexports.errorValues = {\n    '-32700': {\n        standard: 'JSON RPC 2.0',\n        message: 'Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text.',\n    },\n    '-32600': {\n        standard: 'JSON RPC 2.0',\n        message: 'The JSON sent is not a valid Request object.',\n    },\n    '-32601': {\n        standard: 'JSON RPC 2.0',\n        message: 'The method does not exist / is not available.',\n    },\n    '-32602': {\n        standard: 'JSON RPC 2.0',\n        message: 'Invalid method parameter(s).',\n    },\n    '-32603': {\n        standard: 'JSON RPC 2.0',\n        message: 'Internal JSON-RPC error.',\n    },\n    '-32000': {\n        standard: 'EIP-1474',\n        message: 'Invalid input.',\n    },\n    '-32001': {\n        standard: 'EIP-1474',\n        message: 'Resource not found.',\n    },\n    '-32002': {\n        standard: 'EIP-1474',\n        message: 'Resource unavailable.',\n    },\n    '-32003': {\n        standard: 'EIP-1474',\n        message: 'Transaction rejected.',\n    },\n    '-32004': {\n        standard: 'EIP-1474',\n        message: 'Method not supported.',\n    },\n    '-32005': {\n        standard: 'EIP-1474',\n        message: 'Request limit exceeded.',\n    },\n    '4001': {\n        standard: 'EIP-1193',\n        message: 'User rejected the request.',\n    },\n    '4100': {\n        standard: 'EIP-1193',\n        message: 'The requested account and/or method has not been authorized by the user.',\n    },\n    '4200': {\n        standard: 'EIP-1193',\n        message: 'The requested method is not supported by this Ethereum provider.',\n    },\n    '4900': {\n        standard: 'EIP-1193',\n        message: 'The provider is disconnected from all chains.',\n    },\n    '4901': {\n        standard: 'EIP-1193',\n        message: 'The provider is disconnected from the specified chain.',\n    },\n};\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXJyb3ItY29uc3RhbnRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2Vycm9yLWNvbnN0YW50cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUF1QmEsUUFBQSxVQUFVLEdBQWU7SUFDcEMsR0FBRyxFQUFFO1FBQ0gsWUFBWSxFQUFFLENBQUMsS0FBSztRQUNwQixnQkFBZ0IsRUFBRSxDQUFDLEtBQUs7UUFDeEIsbUJBQW1CLEVBQUUsQ0FBQyxLQUFLO1FBQzNCLG1CQUFtQixFQUFFLENBQUMsS0FBSztRQUMzQixrQkFBa0IsRUFBRSxDQUFDLEtBQUs7UUFDMUIsYUFBYSxFQUFFLENBQUMsS0FBSztRQUNyQixLQUFLLEVBQUUsQ0FBQyxLQUFLO1FBQ2IsY0FBYyxFQUFFLENBQUMsS0FBSztRQUN0QixjQUFjLEVBQUUsQ0FBQyxLQUFLO1FBQ3RCLGFBQWEsRUFBRSxDQUFDLEtBQUs7UUFDckIsUUFBUSxFQUFFLENBQUMsS0FBSztLQUNqQjtJQUNELFFBQVEsRUFBRTtRQUNSLG1CQUFtQixFQUFFLElBQUk7UUFDekIsWUFBWSxFQUFFLElBQUk7UUFDbEIsaUJBQWlCLEVBQUUsSUFBSTtRQUN2QixZQUFZLEVBQUUsSUFBSTtRQUNsQixpQkFBaUIsRUFBRSxJQUFJO0tBQ3hCO0NBQ0YsQ0FBQztBQUVXLFFBQUEsV0FBVyxHQUFHO0lBQ3pCLFFBQVEsRUFBRTtRQUNSLFFBQVEsRUFBRSxjQUFjO1FBQ3hCLE9BQU8sRUFBRSx1R0FBdUc7S0FDakg7SUFDRCxRQUFRLEVBQUU7UUFDUixRQUFRLEVBQUUsY0FBYztRQUN4QixPQUFPLEVBQUUsOENBQThDO0tBQ3hEO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsUUFBUSxFQUFFLGNBQWM7UUFDeEIsT0FBTyxFQUFFLCtDQUErQztLQUN6RDtJQUNELFFBQVEsRUFBRTtRQUNSLFFBQVEsRUFBRSxjQUFjO1FBQ3hCLE9BQU8sRUFBRSw4QkFBOEI7S0FDeEM7SUFDRCxRQUFRLEVBQUU7UUFDUixRQUFRLEVBQUUsY0FBYztRQUN4QixPQUFPLEVBQUUsMEJBQTBCO0tBQ3BDO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsUUFBUSxFQUFFLFVBQVU7UUFDcEIsT0FBTyxFQUFFLGdCQUFnQjtLQUMxQjtJQUNELFFBQVEsRUFBRTtRQUNSLFFBQVEsRUFBRSxVQUFVO1FBQ3BCLE9BQU8sRUFBRSxxQkFBcUI7S0FDL0I7SUFDRCxRQUFRLEVBQUU7UUFDUixRQUFRLEVBQUUsVUFBVTtRQUNwQixPQUFPLEVBQUUsdUJBQXVCO0tBQ2pDO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsUUFBUSxFQUFFLFVBQVU7UUFDcEIsT0FBTyxFQUFFLHVCQUF1QjtLQUNqQztJQUNELFFBQVEsRUFBRTtRQUNSLFFBQVEsRUFBRSxVQUFVO1FBQ3BCLE9BQU8sRUFBRSx1QkFBdUI7S0FDakM7SUFDRCxRQUFRLEVBQUU7UUFDUixRQUFRLEVBQUUsVUFBVTtRQUNwQixPQUFPLEVBQUUseUJBQXlCO0tBQ25DO0lBQ0QsTUFBTSxFQUFFO1FBQ04sUUFBUSxFQUFFLFVBQVU7UUFDcEIsT0FBTyxFQUFFLDRCQUE0QjtLQUN0QztJQUNELE1BQU0sRUFBRTtRQUNOLFFBQVEsRUFBRSxVQUFVO1FBQ3BCLE9BQU8sRUFBRSwwRUFBMEU7S0FDcEY7SUFDRCxNQUFNLEVBQUU7UUFDTixRQUFRLEVBQUUsVUFBVTtRQUNwQixPQUFPLEVBQUUsa0VBQWtFO0tBQzVFO0lBQ0QsTUFBTSxFQUFFO1FBQ04sUUFBUSxFQUFFLFVBQVU7UUFDcEIsT0FBTyxFQUFFLCtDQUErQztLQUN6RDtJQUNELE1BQU0sRUFBRTtRQUNOLFFBQVEsRUFBRSxVQUFVO1FBQ3BCLE9BQU8sRUFBRSx3REFBd0Q7S0FDbEU7Q0FDRixDQUFDIn0=","const SafeEventEmitter = require('@metamask/safe-event-emitter').default\n\nclass BaseFilter extends SafeEventEmitter {\n\n  constructor () {\n    super()\n    this.updates = []\n  }\n\n  async initialize () {}\n\n  async update () {\n    throw new Error('BaseFilter - no update method specified')\n  }\n\n  addResults (newResults) {\n    this.updates = this.updates.concat(newResults)\n    newResults.forEach(result => this.emit('update', result))\n  }\n\n  addInitialResults (newResults) {}\n\n  getChangesAndClear () {\n    const updates = this.updates\n    this.updates = []\n    return updates\n  }\n  \n}\n\nmodule.exports = BaseFilter\n","module.exports = getBlocksForRange\n\nasync function getBlocksForRange({ provider, fromBlock, toBlock }) {\n  if (!fromBlock) fromBlock = toBlock\n\n  const fromBlockNumber = hexToInt(fromBlock)\n  const toBlockNumber = hexToInt(toBlock)\n  const blockCountToQuery = toBlockNumber - fromBlockNumber + 1\n  // load all blocks from old to new (inclusive)\n  const missingBlockNumbers = Array(blockCountToQuery).fill()\n                              .map((_,index) => fromBlockNumber + index)\n                              .map(intToHex)\n  const blockBodies = await Promise.all(\n    missingBlockNumbers.map(blockNum => query(provider, 'eth_getBlockByNumber', [blockNum, false]))\n  )\n  return blockBodies\n}\n\nfunction hexToInt(hexString) {\n  if (hexString === undefined || hexString === null) return hexString\n  return Number.parseInt(hexString, 16)\n}\n\nfunction incrementHexInt(hexString){\n  if (hexString === undefined || hexString === null) return hexString\n  const value = hexToInt(hexString)\n  return intToHex(value + 1)\n}\n\nfunction intToHex(int) {\n  if (int === undefined || int === null) return int\n  const hexString = int.toString(16)\n  return '0x' + hexString\n}\n\nfunction query(provider, method, params) {\n  return new Promise((resolve, reject) => {\n    provider.sendAsync({ id: 1, jsonrpc: '2.0', method, params }, (err, res) => {\n      if (err) return reject(err)\n      resolve(res.result)\n    })\n  })\n}\n","const pify = require('pify')\nconst BaseBlockTracker = require('./base')\n\nconst sec = 1000\n\nclass PollingBlockTracker extends BaseBlockTracker {\n\n  constructor (opts = {}) {\n    // parse + validate args\n    if (!opts.provider) throw new Error('PollingBlockTracker - no provider specified.')\n    const pollingInterval = opts.pollingInterval || 20 * sec\n    const retryTimeout = opts.retryTimeout || pollingInterval / 10\n    const keepEventLoopActive = opts.keepEventLoopActive !== undefined ? opts.keepEventLoopActive : true\n    const setSkipCacheFlag = opts.setSkipCacheFlag || false\n    // BaseBlockTracker constructor\n    super(Object.assign({\n      blockResetDuration: pollingInterval,\n    }, opts))\n    // config\n    this._provider = opts.provider\n    this._pollingInterval = pollingInterval\n    this._retryTimeout = retryTimeout\n    this._keepEventLoopActive = keepEventLoopActive\n    this._setSkipCacheFlag = setSkipCacheFlag\n  }\n\n  //\n  // public\n  //\n\n  // trigger block polling\n  async checkForLatestBlock () {\n    await this._updateLatestBlock()\n    return await this.getLatestBlock()\n  }\n\n  //\n  // private\n  //\n\n  _start () {\n    this._performSync().catch(err => this.emit('error', err))\n  }\n\n  async _performSync () {\n    while (this._isRunning) {\n      try {\n        await this._updateLatestBlock()\n        await timeout(this._pollingInterval, !this._keepEventLoopActive)\n      } catch (err) {\n        const newErr = new Error(`PollingBlockTracker - encountered an error while attempting to update latest block:\\n${err.stack}`)\n        try {\n          this.emit('error', newErr)\n        } catch (emitErr) {\n          console.error(newErr)\n        }\n        await timeout(this._retryTimeout, !this._keepEventLoopActive)\n      }\n    }\n  }\n\n  async _updateLatestBlock () {\n    // fetch + set latest block\n    const latestBlock = await this._fetchLatestBlock()\n    this._newPotentialLatest(latestBlock)\n  }\n\n  async _fetchLatestBlock () {\n    const req = { jsonrpc: \"2.0\", id: 1, method: 'eth_blockNumber', params: [] }\n    if (this._setSkipCacheFlag) req.skipCache = true\n    const res = await pify((cb) => this._provider.sendAsync(req, cb))()\n    if (res.error) throw new Error(`PollingBlockTracker - encountered error fetching block:\\n${res.error}`)\n    return res.result\n  }\n\n}\n\nmodule.exports = PollingBlockTracker\n\nfunction timeout (duration, unref) {\n  return new Promise(resolve => {\n    const timoutRef = setTimeout(resolve, duration)\n    // don't keep process open\n    if (timoutRef.unref && unref) {\n      timoutRef.unref()\n    }\n  })\n}\n","'use strict';\n\nconst processFn = (fn, opts) => function () {\n\tconst P = opts.promiseModule;\n\tconst args = new Array(arguments.length);\n\n\tfor (let i = 0; i < arguments.length; i++) {\n\t\targs[i] = arguments[i];\n\t}\n\n\treturn new P((resolve, reject) => {\n\t\tif (opts.errorFirst) {\n\t\t\targs.push(function (err, result) {\n\t\t\t\tif (opts.multiArgs) {\n\t\t\t\t\tconst results = new Array(arguments.length - 1);\n\n\t\t\t\t\tfor (let i = 1; i < arguments.length; i++) {\n\t\t\t\t\t\tresults[i - 1] = arguments[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tresults.unshift(err);\n\t\t\t\t\t\treject(results);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(results);\n\t\t\t\t\t}\n\t\t\t\t} else if (err) {\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(result);\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\targs.push(function (result) {\n\t\t\t\tif (opts.multiArgs) {\n\t\t\t\t\tconst results = new Array(arguments.length - 1);\n\n\t\t\t\t\tfor (let i = 0; i < arguments.length; i++) {\n\t\t\t\t\t\tresults[i] = arguments[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(results);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(result);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tfn.apply(this, args);\n\t});\n};\n\nmodule.exports = (obj, opts) => {\n\topts = Object.assign({\n\t\texclude: [/.+(Sync|Stream)$/],\n\t\terrorFirst: true,\n\t\tpromiseModule: Promise\n\t}, opts);\n\n\tconst filter = key => {\n\t\tconst match = pattern => typeof pattern === 'string' ? key === pattern : pattern.test(key);\n\t\treturn opts.include ? opts.include.some(match) : !opts.exclude.some(match);\n\t};\n\n\tlet ret;\n\tif (typeof obj === 'function') {\n\t\tret = function () {\n\t\t\tif (opts.excludeMain) {\n\t\t\t\treturn obj.apply(this, arguments);\n\t\t\t}\n\n\t\t\treturn processFn(obj, opts).apply(this, arguments);\n\t\t};\n\t} else {\n\t\tret = Object.create(Object.getPrototypeOf(obj));\n\t}\n\n\tfor (const key in obj) { // eslint-disable-line guard-for-in\n\t\tconst x = obj[key];\n\t\tret[key] = typeof x === 'function' && filter(key) ? processFn(x, opts) : x;\n\t}\n\n\treturn ret;\n};\n","var superPropBase = require(\"./superPropBase\");\n\nfunction _get(target, property, receiver) {\n  if (typeof Reflect !== \"undefined\" && Reflect.get) {\n    module.exports = _get = Reflect.get;\n  } else {\n    module.exports = _get = function _get(target, property, receiver) {\n      var base = superPropBase(target, property);\n      if (!base) return;\n      var desc = Object.getOwnPropertyDescriptor(base, property);\n\n      if (desc.get) {\n        return desc.get.call(receiver);\n      }\n\n      return desc.value;\n    };\n  }\n\n  return _get(target, property, receiver || target);\n}\n\nmodule.exports = _get;","const extend = require('xtend')\nconst createRandomId = require('json-rpc-random-id')()\n\nmodule.exports = EthQuery\n\n\nfunction EthQuery(provider){\n  const self = this\n  self.currentProvider = provider\n}\n\n//\n// base queries\n//\n\n// default block\nEthQuery.prototype.getBalance =                          generateFnWithDefaultBlockFor(2, 'eth_getBalance')\nEthQuery.prototype.getCode =                             generateFnWithDefaultBlockFor(2, 'eth_getCode')\nEthQuery.prototype.getTransactionCount =                 generateFnWithDefaultBlockFor(2, 'eth_getTransactionCount')\nEthQuery.prototype.getStorageAt =                        generateFnWithDefaultBlockFor(3, 'eth_getStorageAt')\nEthQuery.prototype.call =                                generateFnWithDefaultBlockFor(2, 'eth_call')\n// standard\nEthQuery.prototype.protocolVersion =                     generateFnFor('eth_protocolVersion')\nEthQuery.prototype.syncing =                             generateFnFor('eth_syncing')\nEthQuery.prototype.coinbase =                            generateFnFor('eth_coinbase')\nEthQuery.prototype.mining =                              generateFnFor('eth_mining')\nEthQuery.prototype.hashrate =                            generateFnFor('eth_hashrate')\nEthQuery.prototype.gasPrice =                            generateFnFor('eth_gasPrice')\nEthQuery.prototype.accounts =                            generateFnFor('eth_accounts')\nEthQuery.prototype.blockNumber =                         generateFnFor('eth_blockNumber')\nEthQuery.prototype.getBlockTransactionCountByHash =      generateFnFor('eth_getBlockTransactionCountByHash')\nEthQuery.prototype.getBlockTransactionCountByNumber =    generateFnFor('eth_getBlockTransactionCountByNumber')\nEthQuery.prototype.getUncleCountByBlockHash =            generateFnFor('eth_getUncleCountByBlockHash')\nEthQuery.prototype.getUncleCountByBlockNumber =          generateFnFor('eth_getUncleCountByBlockNumber')\nEthQuery.prototype.sign =                                generateFnFor('eth_sign')\nEthQuery.prototype.sendTransaction =                     generateFnFor('eth_sendTransaction')\nEthQuery.prototype.sendRawTransaction =                  generateFnFor('eth_sendRawTransaction')\nEthQuery.prototype.estimateGas =                         generateFnFor('eth_estimateGas')\nEthQuery.prototype.getBlockByHash =                      generateFnFor('eth_getBlockByHash')\nEthQuery.prototype.getBlockByNumber =                    generateFnFor('eth_getBlockByNumber')\nEthQuery.prototype.getTransactionByHash =                generateFnFor('eth_getTransactionByHash')\nEthQuery.prototype.getTransactionByBlockHashAndIndex =   generateFnFor('eth_getTransactionByBlockHashAndIndex')\nEthQuery.prototype.getTransactionByBlockNumberAndIndex = generateFnFor('eth_getTransactionByBlockNumberAndIndex')\nEthQuery.prototype.getTransactionReceipt =               generateFnFor('eth_getTransactionReceipt')\nEthQuery.prototype.getUncleByBlockHashAndIndex =         generateFnFor('eth_getUncleByBlockHashAndIndex')\nEthQuery.prototype.getUncleByBlockNumberAndIndex =       generateFnFor('eth_getUncleByBlockNumberAndIndex')\nEthQuery.prototype.getCompilers =                        generateFnFor('eth_getCompilers')\nEthQuery.prototype.compileLLL =                          generateFnFor('eth_compileLLL')\nEthQuery.prototype.compileSolidity =                     generateFnFor('eth_compileSolidity')\nEthQuery.prototype.compileSerpent =                      generateFnFor('eth_compileSerpent')\nEthQuery.prototype.newFilter =                           generateFnFor('eth_newFilter')\nEthQuery.prototype.newBlockFilter =                      generateFnFor('eth_newBlockFilter')\nEthQuery.prototype.newPendingTransactionFilter =         generateFnFor('eth_newPendingTransactionFilter')\nEthQuery.prototype.uninstallFilter =                     generateFnFor('eth_uninstallFilter')\nEthQuery.prototype.getFilterChanges =                    generateFnFor('eth_getFilterChanges')\nEthQuery.prototype.getFilterLogs =                       generateFnFor('eth_getFilterLogs')\nEthQuery.prototype.getLogs =                             generateFnFor('eth_getLogs')\nEthQuery.prototype.getWork =                             generateFnFor('eth_getWork')\nEthQuery.prototype.submitWork =                          generateFnFor('eth_submitWork')\nEthQuery.prototype.submitHashrate =                      generateFnFor('eth_submitHashrate')\n\n// network level\n\nEthQuery.prototype.sendAsync = function(opts, cb){\n  const self = this\n  self.currentProvider.sendAsync(createPayload(opts), function(err, response){\n    if (!err && response.error) err = new Error('EthQuery - RPC Error - '+response.error.message)\n    if (err) return cb(err)\n    cb(null, response.result)\n  })\n}\n\n// util\n\nfunction generateFnFor(methodName){\n  return function(){\n    const self = this\n    var args = [].slice.call(arguments)\n    var cb = args.pop()\n    self.sendAsync({\n      method: methodName,\n      params: args,\n    }, cb)\n  }\n}\n\nfunction generateFnWithDefaultBlockFor(argCount, methodName){\n  return function(){\n    const self = this\n    var args = [].slice.call(arguments)\n    var cb = args.pop()\n    // set optional default block param\n    if (args.length < argCount) args.push('latest')\n    self.sendAsync({\n      method: methodName,\n      params: args,\n    }, cb)\n  }\n}\n\nfunction createPayload(data){\n  return extend({\n    // defaults\n    id: createRandomId(),\n    jsonrpc: '2.0',\n    params: [],\n    // user-specified\n  }, data)\n}\n","const Mutex = require('async-mutex').Mutex\nconst { createAsyncMiddleware } = require('json-rpc-engine')\nconst createJsonRpcMiddleware = require('eth-json-rpc-middleware/scaffold')\nconst LogFilter = require('./log-filter.js')\nconst BlockFilter = require('./block-filter.js')\nconst TxFilter = require('./tx-filter.js')\nconst { intToHex, hexToInt } = require('./hexUtils')\n\nmodule.exports = createEthFilterMiddleware\n\nfunction createEthFilterMiddleware({ blockTracker, provider }) {\n\n  // create filter collection\n  let filterIndex = 0\n  let filters = {}\n  // create update mutex\n  const mutex = new Mutex()\n  const waitForFree = mutexMiddlewareWrapper({ mutex })\n\n  const middleware = createJsonRpcMiddleware({\n    // install filters\n    eth_newFilter:                   waitForFree(toFilterCreationMiddleware(newLogFilter)),\n    eth_newBlockFilter:              waitForFree(toFilterCreationMiddleware(newBlockFilter)),\n    eth_newPendingTransactionFilter: waitForFree(toFilterCreationMiddleware(newPendingTransactionFilter)),\n    // uninstall filters\n    eth_uninstallFilter:             waitForFree(toAsyncRpcMiddleware(uninstallFilterHandler)),\n    // checking filter changes\n    eth_getFilterChanges:            waitForFree(toAsyncRpcMiddleware(getFilterChanges)),\n    eth_getFilterLogs:               waitForFree(toAsyncRpcMiddleware(getFilterLogs)),\n  })\n\n  // setup filter updating and destroy handler\n  const filterUpdater = async ({ oldBlock, newBlock }) => {\n    if (filters.length === 0) return\n    // lock update reads\n    const releaseLock = await mutex.acquire()\n    try {\n      // process all filters in parallel\n      await Promise.all(objValues(filters).map(async (filter) => {\n        try {\n         await filter.update({ oldBlock, newBlock })\n        } catch (err) {\n          // handle each error individually so filter update errors don't affect other filters\n          console.error(err)\n        }\n      }))\n    } catch (err) {\n      // log error so we don't skip the releaseLock\n      console.error(err)\n    }\n    // unlock update reads\n    releaseLock()\n  }\n\n  // expose filter methods directly\n  middleware.newLogFilter = newLogFilter\n  middleware.newBlockFilter = newBlockFilter\n  middleware.newPendingTransactionFilter = newPendingTransactionFilter\n  middleware.uninstallFilter = uninstallFilterHandler\n  middleware.getFilterChanges = getFilterChanges\n  middleware.getFilterLogs = getFilterLogs\n\n  // expose destroy method for cleanup\n  middleware.destroy = () => {\n    uninstallAllFilters()\n  }\n\n  return middleware\n\n  //\n  // new filters\n  //\n\n  async function newLogFilter(params) {\n    const filter = new LogFilter({ provider, params })\n    const filterIndex = await installFilter(filter)\n    return filter\n  }\n\n  async function newBlockFilter() {\n    const filter = new BlockFilter({ provider })\n    const filterIndex = await installFilter(filter)\n    return filter\n  }\n\n  async function newPendingTransactionFilter() {\n    const filter = new TxFilter({ provider })\n    const filterIndex = await installFilter(filter)\n    return filter\n  }\n\n  //\n  // get filter changes\n  //\n\n  async function getFilterChanges(filterIndexHex) {\n    const filterIndex = hexToInt(filterIndexHex)\n    const filter = filters[filterIndex]\n    if (!filter) {\n      throw new Error(`No filter for index \"${filterIndex}\"`)\n    }\n    const results = filter.getChangesAndClear()\n    return results\n  }\n\n  async function getFilterLogs(filterIndexHex) {\n    const filterIndex = hexToInt(filterIndexHex)\n    const filter = filters[filterIndex]\n    if (!filter) {\n      throw new Error(`No filter for index \"${filterIndex}\"`)\n    }\n    // only return results for log filters\n    if (filter.type === 'log') {\n      results = filter.getAllResults()\n    } else {\n      results = []\n    }\n    return results\n  }\n\n\n  //\n  // remove filters\n  //\n\n\n  async function uninstallFilterHandler(filterIndexHex) {\n    // check filter exists\n    const filterIndex = hexToInt(filterIndexHex)\n    const filter = filters[filterIndex]\n    const result = Boolean(filter)\n    // uninstall filter\n    if (result) {\n      await uninstallFilter(filterIndex)\n    }\n    return result\n  }\n\n  //\n  // utils\n  //\n\n  async function installFilter(filter) {\n    const prevFilterCount = objValues(filters).length\n    // install filter\n    const currentBlock = await blockTracker.getLatestBlock()\n    await filter.initialize({ currentBlock })\n    filterIndex++\n    filters[filterIndex] = filter\n    filter.id = filterIndex\n    filter.idHex = intToHex(filterIndex)\n    // update block tracker subs\n    const newFilterCount = objValues(filters).length\n    updateBlockTrackerSubs({ prevFilterCount, newFilterCount })\n    return filterIndex\n  }\n\n  async function uninstallFilter(filterIndex) {\n    const prevFilterCount = objValues(filters).length\n    delete filters[filterIndex]\n    // update block tracker subs\n    const newFilterCount = objValues(filters).length\n    updateBlockTrackerSubs({ prevFilterCount, newFilterCount })\n  }\n\n  async function uninstallAllFilters() {\n    const prevFilterCount = objValues(filters).length\n    filters = {}\n    // update block tracker subs\n    updateBlockTrackerSubs({ prevFilterCount, newFilterCount: 0 })\n  }\n\n  function updateBlockTrackerSubs({ prevFilterCount, newFilterCount }) {\n    // subscribe\n    if (prevFilterCount === 0 && newFilterCount > 0) {\n      blockTracker.on('sync', filterUpdater)\n      return\n    }\n    // unsubscribe\n    if (prevFilterCount > 0 && newFilterCount === 0) {\n      blockTracker.removeListener('sync', filterUpdater)\n      return\n    }\n  }\n\n}\n\n// helper for turning filter constructors into rpc middleware\nfunction toFilterCreationMiddleware(createFilterFn) {\n  return toAsyncRpcMiddleware(async (...args) => {\n    const filter = await createFilterFn(...args)\n    const result = intToHex(filter.id)\n    return result\n  })\n}\n\n// helper for pulling out req.params and setting res.result\nfunction toAsyncRpcMiddleware(asyncFn) {\n  return createAsyncMiddleware(async (req, res) => {\n    const result = await asyncFn.apply(null, req.params)\n    res.result = result\n  })\n}\n\nfunction mutexMiddlewareWrapper({ mutex }) {\n  return (middleware) => {\n    return async (req, res, next, end) => {\n      // wait for mutex available\n      // we can release immediately because\n      // we just need to make sure updates aren't active\n      const releaseLock = await mutex.acquire()\n      releaseLock()\n      middleware(req, res, next, end)\n    }\n  }\n}\n\nfunction objValues(obj, fn){\n  const values = []\n  for (let key in obj) {\n    values.push(obj[key])\n  }\n  return values\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getUniqueId = void 0;\n// uint32 (two's complement) max\n// more conservative than Number.MAX_SAFE_INTEGER\nconst MAX = 4294967295;\nlet idCounter = Math.floor(Math.random() * MAX);\nfunction getUniqueId() {\n    idCounter = (idCounter + 1) % MAX;\n    return idCounter;\n}\nexports.getUniqueId = getUniqueId;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0VW5pcXVlSWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZ2V0VW5pcXVlSWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsZ0NBQWdDO0FBQ2hDLGlEQUFpRDtBQUNqRCxNQUFNLEdBQUcsR0FBRyxVQUFVLENBQUM7QUFDdkIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUM7QUFFaEQsU0FBZ0IsV0FBVztJQUN6QixTQUFTLEdBQUcsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ2xDLE9BQU8sU0FBUyxDQUFDO0FBQ25CLENBQUM7QUFIRCxrQ0FHQyJ9","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.JsonRpcEngine = void 0;\nconst safe_event_emitter_1 = __importDefault(require(\"@metamask/safe-event-emitter\"));\nconst eth_rpc_errors_1 = require(\"eth-rpc-errors\");\n/**\n * A JSON-RPC request and response processor.\n * Give it a stack of middleware, pass it requests, and get back responses.\n */\nclass JsonRpcEngine extends safe_event_emitter_1.default {\n    constructor() {\n        super();\n        this._middleware = [];\n    }\n    /**\n     * Add a middleware function to the engine's middleware stack.\n     *\n     * @param middleware - The middleware function to add.\n     */\n    push(middleware) {\n        this._middleware.push(middleware);\n    }\n    handle(req, cb) {\n        if (cb && typeof cb !== 'function') {\n            throw new Error('\"callback\" must be a function if provided.');\n        }\n        if (Array.isArray(req)) {\n            if (cb) {\n                return this._handleBatch(req, cb);\n            }\n            return this._handleBatch(req);\n        }\n        if (cb) {\n            return this._handle(req, cb);\n        }\n        return this._promiseHandle(req);\n    }\n    /**\n     * Returns this engine as a middleware function that can be pushed to other\n     * engines.\n     *\n     * @returns This engine as a middleware function.\n     */\n    asMiddleware() {\n        return async (req, res, next, end) => {\n            try {\n                const [middlewareError, isComplete, returnHandlers,] = await JsonRpcEngine._runAllMiddleware(req, res, this._middleware);\n                if (isComplete) {\n                    await JsonRpcEngine._runReturnHandlers(returnHandlers);\n                    return end(middlewareError);\n                }\n                return next(async (handlerCallback) => {\n                    try {\n                        await JsonRpcEngine._runReturnHandlers(returnHandlers);\n                    }\n                    catch (error) {\n                        return handlerCallback(error);\n                    }\n                    return handlerCallback();\n                });\n            }\n            catch (error) {\n                return end(error);\n            }\n        };\n    }\n    async _handleBatch(reqs, cb) {\n        // The order here is important\n        try {\n            // 2. Wait for all requests to finish, or throw on some kind of fatal\n            // error\n            const responses = await Promise.all(\n            // 1. Begin executing each request in the order received\n            reqs.map(this._promiseHandle.bind(this)));\n            // 3. Return batch response\n            if (cb) {\n                return cb(null, responses);\n            }\n            return responses;\n        }\n        catch (error) {\n            if (cb) {\n                return cb(error);\n            }\n            throw error;\n        }\n    }\n    /**\n     * A promise-wrapped _handle.\n     */\n    _promiseHandle(req) {\n        return new Promise((resolve) => {\n            this._handle(req, (_err, res) => {\n                // There will always be a response, and it will always have any error\n                // that is caught and propagated.\n                resolve(res);\n            });\n        });\n    }\n    /**\n     * Ensures that the request object is valid, processes it, and passes any\n     * error and the response object to the given callback.\n     *\n     * Does not reject.\n     */\n    async _handle(callerReq, cb) {\n        if (!callerReq ||\n            Array.isArray(callerReq) ||\n            typeof callerReq !== 'object') {\n            const error = new eth_rpc_errors_1.EthereumRpcError(eth_rpc_errors_1.errorCodes.rpc.invalidRequest, `Requests must be plain objects. Received: ${typeof callerReq}`, { request: callerReq });\n            return cb(error, { id: undefined, jsonrpc: '2.0', error });\n        }\n        if (typeof callerReq.method !== 'string') {\n            const error = new eth_rpc_errors_1.EthereumRpcError(eth_rpc_errors_1.errorCodes.rpc.invalidRequest, `Must specify a string method. Received: ${typeof callerReq.method}`, { request: callerReq });\n            return cb(error, { id: callerReq.id, jsonrpc: '2.0', error });\n        }\n        const req = Object.assign({}, callerReq);\n        const res = {\n            id: req.id,\n            jsonrpc: req.jsonrpc,\n        };\n        let error = null;\n        try {\n            await this._processRequest(req, res);\n        }\n        catch (_error) {\n            // A request handler error, a re-thrown middleware error, or something\n            // unexpected.\n            error = _error;\n        }\n        if (error) {\n            // Ensure no result is present on an errored response\n            delete res.result;\n            if (!res.error) {\n                res.error = eth_rpc_errors_1.serializeError(error);\n            }\n        }\n        return cb(error, res);\n    }\n    /**\n     * For the given request and response, runs all middleware and their return\n     * handlers, if any, and ensures that internal request processing semantics\n     * are satisfied.\n     */\n    async _processRequest(req, res) {\n        const [error, isComplete, returnHandlers,] = await JsonRpcEngine._runAllMiddleware(req, res, this._middleware);\n        // Throw if \"end\" was not called, or if the response has neither a result\n        // nor an error.\n        JsonRpcEngine._checkForCompletion(req, res, isComplete);\n        // The return handlers should run even if an error was encountered during\n        // middleware processing.\n        await JsonRpcEngine._runReturnHandlers(returnHandlers);\n        // Now we re-throw the middleware processing error, if any, to catch it\n        // further up the call chain.\n        if (error) {\n            throw error;\n        }\n    }\n    /**\n     * Serially executes the given stack of middleware.\n     *\n     * @returns An array of any error encountered during middleware execution,\n     * a boolean indicating whether the request was completed, and an array of\n     * middleware-defined return handlers.\n     */\n    static async _runAllMiddleware(req, res, middlewareStack) {\n        const returnHandlers = [];\n        let error = null;\n        let isComplete = false;\n        // Go down stack of middleware, call and collect optional returnHandlers\n        for (const middleware of middlewareStack) {\n            [error, isComplete] = await JsonRpcEngine._runMiddleware(req, res, middleware, returnHandlers);\n            if (isComplete) {\n                break;\n            }\n        }\n        return [error, isComplete, returnHandlers.reverse()];\n    }\n    /**\n     * Runs an individual middleware.\n     *\n     * @returns An array of any error encountered during middleware exection,\n     * and a boolean indicating whether the request should end.\n     */\n    static _runMiddleware(req, res, middleware, returnHandlers) {\n        return new Promise((resolve) => {\n            const end = (err) => {\n                const error = err || res.error;\n                if (error) {\n                    res.error = eth_rpc_errors_1.serializeError(error);\n                }\n                // True indicates that the request should end\n                resolve([error, true]);\n            };\n            const next = (returnHandler) => {\n                if (res.error) {\n                    end(res.error);\n                }\n                else {\n                    if (returnHandler) {\n                        if (typeof returnHandler !== 'function') {\n                            end(new eth_rpc_errors_1.EthereumRpcError(eth_rpc_errors_1.errorCodes.rpc.internal, `JsonRpcEngine: \"next\" return handlers must be functions. ` +\n                                `Received \"${typeof returnHandler}\" for request:\\n${jsonify(req)}`, { request: req }));\n                        }\n                        returnHandlers.push(returnHandler);\n                    }\n                    // False indicates that the request should not end\n                    resolve([null, false]);\n                }\n            };\n            try {\n                middleware(req, res, next, end);\n            }\n            catch (error) {\n                end(error);\n            }\n        });\n    }\n    /**\n     * Serially executes array of return handlers. The request and response are\n     * assumed to be in their scope.\n     */\n    static async _runReturnHandlers(handlers) {\n        for (const handler of handlers) {\n            await new Promise((resolve, reject) => {\n                handler((err) => (err ? reject(err) : resolve()));\n            });\n        }\n    }\n    /**\n     * Throws an error if the response has neither a result nor an error, or if\n     * the \"isComplete\" flag is falsy.\n     */\n    static _checkForCompletion(req, res, isComplete) {\n        if (!('result' in res) && !('error' in res)) {\n            throw new eth_rpc_errors_1.EthereumRpcError(eth_rpc_errors_1.errorCodes.rpc.internal, `JsonRpcEngine: Response has no error or result for request:\\n${jsonify(req)}`, { request: req });\n        }\n        if (!isComplete) {\n            throw new eth_rpc_errors_1.EthereumRpcError(eth_rpc_errors_1.errorCodes.rpc.internal, `JsonRpcEngine: Nothing ended request:\\n${jsonify(req)}`, { request: req });\n        }\n    }\n}\nexports.JsonRpcEngine = JsonRpcEngine;\nfunction jsonify(request) {\n    return JSON.stringify(request, null, 2);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSnNvblJwY0VuZ2luZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9Kc29uUnBjRW5naW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLHNGQUE0RDtBQUM1RCxtREFBOEU7QUF1RjlFOzs7R0FHRztBQUNILE1BQWEsYUFBYyxTQUFRLDRCQUFnQjtJQUdqRDtRQUNFLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxJQUFJLENBQU8sVUFBbUM7UUFDNUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBaUQsQ0FBQyxDQUFDO0lBQzNFLENBQUM7SUEyQ0QsTUFBTSxDQUFDLEdBQVksRUFBRSxFQUFRO1FBQzNCLElBQUksRUFBRSxJQUFJLE9BQU8sRUFBRSxLQUFLLFVBQVUsRUFBRTtZQUNsQyxNQUFNLElBQUksS0FBSyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7U0FDL0Q7UUFFRCxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDdEIsSUFBSSxFQUFFLEVBQUU7Z0JBQ04sT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQzthQUNuQztZQUNELE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUMvQjtRQUVELElBQUksRUFBRSxFQUFFO1lBQ04sT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQThCLEVBQUUsRUFBRSxDQUFDLENBQUM7U0FDekQ7UUFDRCxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBOEIsQ0FBQyxDQUFDO0lBQzdELENBQUM7SUFFRDs7Ozs7T0FLRztJQUNILFlBQVk7UUFDVixPQUFPLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsRUFBRTtZQUNuQyxJQUFJ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","module.exports = stringify\nstringify.default = stringify\nstringify.stable = deterministicStringify\nstringify.stableStringify = deterministicStringify\n\nvar arr = []\nvar replacerStack = []\n\n// Regular stringify\nfunction stringify (obj, replacer, spacer) {\n  decirc(obj, '', [], undefined)\n  var res\n  if (replacerStack.length === 0) {\n    res = JSON.stringify(obj, replacer, spacer)\n  } else {\n    res = JSON.stringify(obj, replaceGetterValues(replacer), spacer)\n  }\n  while (arr.length !== 0) {\n    var part = arr.pop()\n    if (part.length === 4) {\n      Object.defineProperty(part[0], part[1], part[3])\n    } else {\n      part[0][part[1]] = part[2]\n    }\n  }\n  return res\n}\nfunction decirc (val, k, stack, parent) {\n  var i\n  if (typeof val === 'object' && val !== null) {\n    for (i = 0; i < stack.length; i++) {\n      if (stack[i] === val) {\n        var propertyDescriptor = Object.getOwnPropertyDescriptor(parent, k)\n        if (propertyDescriptor.get !== undefined) {\n          if (propertyDescriptor.configurable) {\n            Object.defineProperty(parent, k, { value: '[Circular]' })\n            arr.push([parent, k, val, propertyDescriptor])\n          } else {\n            replacerStack.push([val, k])\n          }\n        } else {\n          parent[k] = '[Circular]'\n          arr.push([parent, k, val])\n        }\n        return\n      }\n    }\n    stack.push(val)\n    // Optimize for Arrays. Big arrays could kill the performance otherwise!\n    if (Array.isArray(val)) {\n      for (i = 0; i < val.length; i++) {\n        decirc(val[i], i, stack, val)\n      }\n    } else {\n      var keys = Object.keys(val)\n      for (i = 0; i < keys.length; i++) {\n        var key = keys[i]\n        decirc(val[key], key, stack, val)\n      }\n    }\n    stack.pop()\n  }\n}\n\n// Stable-stringify\nfunction compareFunction (a, b) {\n  if (a < b) {\n    return -1\n  }\n  if (a > b) {\n    return 1\n  }\n  return 0\n}\n\nfunction deterministicStringify (obj, replacer, spacer) {\n  var tmp = deterministicDecirc(obj, '', [], undefined) || obj\n  var res\n  if (replacerStack.length === 0) {\n    res = JSON.stringify(tmp, replacer, spacer)\n  } else {\n    res = JSON.stringify(tmp, replaceGetterValues(replacer), spacer)\n  }\n  while (arr.length !== 0) {\n    var part = arr.pop()\n    if (part.length === 4) {\n      Object.defineProperty(part[0], part[1], part[3])\n    } else {\n      part[0][part[1]] = part[2]\n    }\n  }\n  return res\n}\n\nfunction deterministicDecirc (val, k, stack, parent) {\n  var i\n  if (typeof val === 'object' && val !== null) {\n    for (i = 0; i < stack.length; i++) {\n      if (stack[i] === val) {\n        var propertyDescriptor = Object.getOwnPropertyDescriptor(parent, k)\n        if (propertyDescriptor.get !== undefined) {\n          if (propertyDescriptor.configurable) {\n            Object.defineProperty(parent, k, { value: '[Circular]' })\n            arr.push([parent, k, val, propertyDescriptor])\n          } else {\n            replacerStack.push([val, k])\n          }\n        } else {\n          parent[k] = '[Circular]'\n          arr.push([parent, k, val])\n        }\n        return\n      }\n    }\n    if (typeof val.toJSON === 'function') {\n      return\n    }\n    stack.push(val)\n    // Optimize for Arrays. Big arrays could kill the performance otherwise!\n    if (Array.isArray(val)) {\n      for (i = 0; i < val.length; i++) {\n        deterministicDecirc(val[i], i, stack, val)\n      }\n    } else {\n      // Create a temporary object in the required way\n      var tmp = {}\n      var keys = Object.keys(val).sort(compareFunction)\n      for (i = 0; i < keys.length; i++) {\n        var key = keys[i]\n        deterministicDecirc(val[key], key, stack, val)\n        tmp[key] = val[key]\n      }\n      if (parent !== undefined) {\n        arr.push([parent, k, val])\n        parent[k] = tmp\n      } else {\n        return tmp\n      }\n    }\n    stack.pop()\n  }\n}\n\n// wraps replacer function to handle values we couldn't replace\n// and mark them as [Circular]\nfunction replaceGetterValues (replacer) {\n  replacer = replacer !== undefined ? replacer : function (k, v) { return v }\n  return function (key, val) {\n    if (replacerStack.length > 0) {\n      for (var i = 0; i < replacerStack.length; i++) {\n        var part = replacerStack[i]\n        if (part[1] === key && part[0] === val) {\n          val = '[Circular]'\n          replacerStack.splice(i, 1)\n          break\n        }\n      }\n    }\n    return replacer.call(this, key, val)\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.serializeError = exports.isValidCode = exports.getMessageFromCode = exports.JSON_RPC_SERVER_ERROR_MESSAGE = void 0;\nconst error_constants_1 = require(\"./error-constants\");\nconst classes_1 = require(\"./classes\");\nconst FALLBACK_ERROR_CODE = error_constants_1.errorCodes.rpc.internal;\nconst FALLBACK_MESSAGE = 'Unspecified error message. This is a bug, please report it.';\nconst FALLBACK_ERROR = {\n    code: FALLBACK_ERROR_CODE,\n    message: getMessageFromCode(FALLBACK_ERROR_CODE),\n};\nexports.JSON_RPC_SERVER_ERROR_MESSAGE = 'Unspecified server error.';\n/**\n * Gets the message for a given code, or a fallback message if the code has\n * no corresponding message.\n */\nfunction getMessageFromCode(code, fallbackMessage = FALLBACK_MESSAGE) {\n    if (Number.isInteger(code)) {\n        const codeString = code.toString();\n        if (hasKey(error_constants_1.errorValues, codeString)) {\n            return error_constants_1.errorValues[codeString].message;\n        }\n        if (isJsonRpcServerError(code)) {\n            return exports.JSON_RPC_SERVER_ERROR_MESSAGE;\n        }\n    }\n    return fallbackMessage;\n}\nexports.getMessageFromCode = getMessageFromCode;\n/**\n * Returns whether the given code is valid.\n * A code is only valid if it has a message.\n */\nfunction isValidCode(code) {\n    if (!Number.isInteger(code)) {\n        return false;\n    }\n    const codeString = code.toString();\n    if (error_constants_1.errorValues[codeString]) {\n        return true;\n    }\n    if (isJsonRpcServerError(code)) {\n        return true;\n    }\n    return false;\n}\nexports.isValidCode = isValidCode;\n/**\n * Serializes the given error to an Ethereum JSON RPC-compatible error object.\n * Merely copies the given error's values if it is already compatible.\n * If the given error is not fully compatible, it will be preserved on the\n * returned object's data.originalError property.\n */\nfunction serializeError(error, { fallbackError = FALLBACK_ERROR, shouldIncludeStack = false, } = {}) {\n    var _a, _b;\n    if (!fallbackError ||\n        !Number.isInteger(fallbackError.code) ||\n        typeof fallbackError.message !== 'string') {\n        throw new Error('Must provide fallback error with integer number code and string message.');\n    }\n    if (error instanceof classes_1.EthereumRpcError) {\n        return error.serialize();\n    }\n    const serialized = {};\n    if (error &&\n        typeof error === 'object' &&\n        !Array.isArray(error) &&\n        hasKey(error, 'code') &&\n        isValidCode(error.code)) {\n        const _error = error;\n        serialized.code = _error.code;\n        if (_error.message && typeof _error.message === 'string') {\n            serialized.message = _error.message;\n            if (hasKey(_error, 'data')) {\n                serialized.data = _error.data;\n            }\n        }\n        else {\n            serialized.message = getMessageFromCode(serialized.code);\n            serialized.data = { originalError: assignOriginalError(error) };\n        }\n    }\n    else {\n        serialized.code = fallbackError.code;\n        const message = (_a = error) === null || _a === void 0 ? void 0 : _a.message;\n        serialized.message = (message && typeof message === 'string'\n            ? message\n            : fallbackError.message);\n        serialized.data = { originalError: assignOriginalError(error) };\n    }\n    const stack = (_b = error) === null || _b === void 0 ? void 0 : _b.stack;\n    if (shouldIncludeStack && error && stack && typeof stack === 'string') {\n        serialized.stack = stack;\n    }\n    return serialized;\n}\nexports.serializeError = serializeError;\n// Internal\nfunction isJsonRpcServerError(code) {\n    return code >= -32099 && code <= -32000;\n}\nfunction assignOriginalError(error) {\n    if (error && typeof error === 'object' && !Array.isArray(error)) {\n        return Object.assign({}, error);\n    }\n    return error;\n}\nfunction hasKey(obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvdXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsdURBQTREO0FBQzVELHVDQUF5RTtBQUV6RSxNQUFNLG1CQUFtQixHQUFHLDRCQUFVLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQztBQUNwRCxNQUFNLGdCQUFnQixHQUFHLDZEQUE2RCxDQUFDO0FBQ3ZGLE1BQU0sY0FBYyxHQUErQjtJQUNqRCxJQUFJLEVBQUUsbUJBQW1CO0lBQ3pCLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQyxtQkFBbUIsQ0FBQztDQUNqRCxDQUFDO0FBRVcsUUFBQSw2QkFBNkIsR0FBRywyQkFBMkIsQ0FBQztBQUl6RTs7O0dBR0c7QUFDSCxTQUFnQixrQkFBa0IsQ0FDaEMsSUFBWSxFQUNaLGtCQUEwQixnQkFBZ0I7SUFFMUMsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFO1FBQzFCLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUVuQyxJQUFJLE1BQU0sQ0FBQyw2QkFBVyxFQUFFLFVBQVUsQ0FBQyxFQUFFO1lBQ25DLE9BQU8sNkJBQVcsQ0FBQyxVQUEyQixDQUFDLENBQUMsT0FBTyxDQUFDO1NBQ3pEO1FBQ0QsSUFBSSxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUM5QixPQUFPLHFDQUE2QixDQUFDO1NBQ3RDO0tBQ0Y7SUFDRCxPQUFPLGVBQWUsQ0FBQztBQUN6QixDQUFDO0FBZkQsZ0RBZUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixXQUFXLENBQUMsSUFBWTtJQUN0QyxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUMzQixPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ25DLElBQUksNkJBQVcsQ0FBQyxVQUEy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","// for backwards compat\nmodule.exports = require('json-rpc-engine/src/createScaffoldMiddleware')\n","const SafeEventEmitter = require('@metamask/safe-event-emitter').default\nconst createScaffoldMiddleware = require('eth-json-rpc-middleware/scaffold')\nconst { createAsyncMiddleware } = require('json-rpc-engine')\nconst createFilterMiddleware = require('./index.js')\nconst { unsafeRandomBytes, incrementHexInt } = require('./hexUtils.js')\nconst getBlocksForRange = require('./getBlocksForRange.js')\n\nmodule.exports = createSubscriptionMiddleware\n\n\nfunction createSubscriptionMiddleware({ blockTracker, provider }) {\n  // state and utilities for handling subscriptions\n  const subscriptions = {}\n  const filterManager = createFilterMiddleware({ blockTracker, provider })\n\n  // internal flag\n  let isDestroyed = false\n\n  // create subscriptionManager api object\n  const events = new SafeEventEmitter()\n  const middleware = createScaffoldMiddleware({\n    eth_subscribe: createAsyncMiddleware(subscribe),\n    eth_unsubscribe: createAsyncMiddleware(unsubscribe),\n  })\n  middleware.destroy = destroy\n  return { events, middleware }\n\n  async function subscribe(req, res) {\n\n    if (isDestroyed) throw new Error(\n      'SubscriptionManager - attempting to use after destroying'\n    )\n\n    const subscriptionType = req.params[0]\n    // subId is 16 byte hex string\n    const subId = unsafeRandomBytes(16)\n\n    // create sub\n    let sub\n    switch (subscriptionType) {\n      case 'newHeads':\n        sub = createSubNewHeads({ subId })\n        break\n      case 'logs':\n        const filterParams = req.params[1]\n        const filter = await filterManager.newLogFilter(filterParams)\n        sub = createSubFromFilter({ subId, filter })\n        break\n      default:\n        throw new Error(`SubscriptionManager - unsupported subscription type \"${subscriptionType}\"`)\n\n    }\n    subscriptions[subId] = sub\n\n    res.result = subId\n    return\n\n    function createSubNewHeads({ subId }) {\n      const sub = {\n        type: subscriptionType,\n        destroy: async () => {\n          blockTracker.removeListener('sync', sub.update)\n        },\n        update: async ({ oldBlock, newBlock }) => {\n          // for newHeads\n          const toBlock = newBlock\n          const fromBlock = incrementHexInt(oldBlock)\n          const rawBlocks = await getBlocksForRange({ provider, fromBlock, toBlock })\n          const results = rawBlocks.map(normalizeBlock)\n          results.forEach((value) => {\n            _emitSubscriptionResult(subId, value)\n          })\n        }\n      }\n      // check for subscription updates on new block\n      blockTracker.on('sync', sub.update)\n      return sub\n    }\n\n    function createSubFromFilter({ subId, filter }){\n      filter.on('update', result => _emitSubscriptionResult(subId, result))\n      const sub = {\n        type: subscriptionType,\n        destroy: async () => {\n          return await filterManager.uninstallFilter(filter.idHex)\n        },\n      }\n      return sub\n    }\n  }\n\n  async function unsubscribe(req, res) {\n\n    if (isDestroyed) throw new Error(\n      'SubscriptionManager - attempting to use after destroying'\n    )\n\n    const id = req.params[0]\n    const subscription = subscriptions[id]\n    // if missing, return \"false\" to indicate it was not removed\n    if (!subscription) {\n      res.result = false\n      return\n    }\n    // cleanup subscription\n    delete subscriptions[id]\n    await subscription.destroy()\n    res.result = true\n  }\n\n  function _emitSubscriptionResult(filterIdHex, value) {\n    events.emit('notification', {\n      jsonrpc: '2.0',\n      method: 'eth_subscription',\n      params: {\n        subscription: filterIdHex,\n        result: value,\n      },\n    })\n  }\n\n  function destroy () {\n    events.removeAllListeners()\n    for (const id in subscriptions) {\n      subscriptions[id].destroy()\n      delete subscriptions[id]\n    }\n    isDestroyed = true\n  }\n}\n\nfunction normalizeBlock(block) {\n  return {\n    hash: block.hash,\n    parentHash: block.parentHash,\n    sha3Uncles: block.sha3Uncles,\n    miner: block.miner,\n    stateRoot: block.stateRoot,\n    transactionsRoot: block.transactionsRoot,\n    receiptsRoot: block.receiptsRoot,\n    logsBloom: block.logsBloom,\n    difficulty: block.difficulty,\n    number: block.number,\n    gasLimit: block.gasLimit,\n    gasUsed: block.gasUsed,\n    nonce: block.nonce,\n    mixHash: block.mixHash,\n    timestamp: block.timestamp,\n    extraData: block.extraData,\n  }\n}\n","var arrayLikeToArray = require(\"./arrayLikeToArray\");\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}\n\nmodule.exports = _arrayWithoutHoles;","function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nmodule.exports = _iterableToArray;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nmodule.exports = _nonIterableSpread;"],"sourceRoot":""}